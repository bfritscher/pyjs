(function(Le,bt){typeof exports=="object"&&typeof module<"u"?bt(exports):typeof define=="function"&&define.amd?define(["exports"],bt):(Le=typeof globalThis<"u"?globalThis:Le||self,bt(Le.EditorBundle={}))})(this,function(Le){"use strict";const bt=()=>new Map,$r=e=>{const t=bt();return e.forEach((n,r)=>{t.set(r,n)}),t},Jt=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},nc=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},rc=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Pe=()=>new Set,Gr=e=>e[e.length-1],sc=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},xe=Array.from,ic=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},oc=(e,t)=>{const n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n},Wr=Array.isArray;class ur{constructor(){this._observers=bt()}on(t,n){return Jt(this._observers,t,Pe).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return xe((this._observers.get(t)||bt()).values()).forEach(r=>r(...n))}destroy(){this._observers=bt()}}class cc{constructor(){this._observers=bt()}on(t,n){Jt(this._observers,t,Pe).add(n)}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return xe((this._observers.get(t)||bt()).values()).forEach(r=>r(...n))}destroy(){this._observers=bt()}}const Ie=Math.floor,hr=Math.abs,Jr=(e,t)=>e<t?e:t,an=(e,t)=>e>t?e:t,lc=Math.pow,Ys=e=>e!==0?e<0:1/e<0,Xs=1,Ks=2,Yr=4,Xr=8,Bn=32,Te=64,ne=128,fr=31,Kr=63,un=127,ac=2147483647,Qs=Number.MAX_SAFE_INTEGER,uc=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ie(e)===e),hc=String.fromCharCode,fc=e=>e.toLowerCase(),dc=/^\s*/g,gc=e=>e.replace(dc,""),pc=/([A-Z])/g,Zs=(e,t)=>gc(e.replace(pc,n=>`${t}${fc(n)}`)),yc=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},Fn=typeof TextEncoder<"u"?new TextEncoder:null,_c=Fn?e=>Fn.encode(e):yc;let Vn=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Vn&&Vn.decode(new Uint8Array).length===1&&(Vn=null);const mc=(e,t)=>oc(t,()=>e).join("");class zn{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Rt=()=>new zn,Qr=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ft=e=>{const t=new Uint8Array(Qr(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},wc=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(an(n,t)*2),e.cpos=0)},jt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},qn=jt,U=(e,t)=>{for(;t>un;)jt(e,ne|un&t),t=Ie(t/128);jt(e,un&t)},dr=(e,t)=>{const n=Ys(t);for(n&&(t=-t),jt(e,(t>Kr?ne:0)|(n?Te:0)|Kr&t),t=Ie(t/64);t>0;)jt(e,(t>un?ne:0)|un&t),t=Ie(t/128)},Zr=new Uint8Array(3e4),bc=Zr.length/3,vc=(e,t)=>{if(t.length<bc){const n=Fn.encodeInto(t,Zr).written||0;U(e,n);for(let r=0;r<n;r++)jt(e,Zr[r])}else Ct(e,_c(t))},Sc=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;U(e,r);for(let s=0;s<r;s++)jt(e,n.codePointAt(s))},He=Fn&&Fn.encodeInto?vc:Sc,kc=(e,t)=>Pn(e,ft(t)),Pn=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Jr(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(an(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},Ct=(e,t)=>{U(e,t.byteLength),Pn(e,t)},ts=(e,t)=>{wc(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Cc=(e,t)=>ts(e,4).setFloat32(0,t,!1),Ec=(e,t)=>ts(e,8).setFloat64(0,t,!1),Ac=(e,t)=>ts(e,8).setBigInt64(0,t,!1),ti=new DataView(new ArrayBuffer(4)),Dc=e=>(ti.setFloat32(0,e),ti.getFloat32(0)===e),Hn=(e,t)=>{switch(typeof t){case"string":jt(e,119),He(e,t);break;case"number":uc(t)&&hr(t)<=ac?(jt(e,125),dr(e,t)):Dc(t)?(jt(e,124),Cc(e,t)):(jt(e,123),Ec(e,t));break;case"bigint":jt(e,122),Ac(e,t);break;case"object":if(t===null)jt(e,126);else if(Wr(t)){jt(e,117),U(e,t.length);for(let n=0;n<t.length;n++)Hn(e,t[n])}else if(t instanceof Uint8Array)jt(e,116),Ct(e,t);else{jt(e,118);const n=Object.keys(t);U(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];He(e,s),Hn(e,t[s])}}break;case"boolean":jt(e,t?120:121);break;default:jt(e,127)}};class ei extends zn{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&U(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const ni=e=>{e.count>0&&(dr(e.encoder,e.count===1?e.s:-e.s),e.count>1&&U(e.encoder,e.count-2))};class gr{constructor(){this.encoder=new zn,this.s=0,this.count=0}write(t){this.s===t?this.count++:(ni(this),this.count=1,this.s=t)}toUint8Array(){return ni(this),ft(this.encoder)}}const ri=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);dr(e.encoder,t),e.count>1&&U(e.encoder,e.count-2)}};class es{constructor(){this.encoder=new zn,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(ri(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return ri(this),ft(this.encoder)}}class Oc{constructor(){this.sarr=[],this.s="",this.lensE=new gr}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new zn;return this.sarr.push(this.s),this.s="",He(t,this.sarr.join("")),Pn(t,this.lensE.toUint8Array()),ft(t)}}const $e=e=>new Error(e),be=()=>{throw $e("Method unimplemented")},Zt=()=>{throw $e("Unexpected case")},si=$e("Unexpected end of array"),ii=$e("Integer out of Range");class pr{constructor(t){this.arr=t,this.pos=0}}const Nt=e=>new pr(e),oi=e=>e.pos!==e.arr.length,Lc=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Ht=e=>Lc(e,$(e)),An=e=>e.arr[e.pos++],$=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&un)*n,n*=128,s<ne)return t;if(t>Qs)throw ii}throw si},yr=e=>{let t=e.arr[e.pos++],n=t&Kr,r=64;const s=(t&Te)>0?-1:1;if(!(t&ne))return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&un)*r,r*=128,t<ne)return s*n;if(n>Qs)throw ii}throw si},Me=Vn?e=>Vn.decode(Ht(e)):e=>{let t=$(e);if(t===0)return"";{let n=String.fromCodePoint(An(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(An(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},ns=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},xc=[e=>{},e=>null,yr,e=>ns(e,4).getFloat32(0,!1),e=>ns(e,8).getFloat64(0,!1),e=>ns(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Me,e=>{const t=$(e),n={};for(let r=0;r<t;r++){const s=Me(e);n[s]=$n(e)}return n},e=>{const t=$(e),n=[];for(let r=0;r<t;r++)n.push($n(e));return n},Ht],$n=e=>xc[127-An(e)](e);class ci extends pr{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),oi(this)?this.count=$(this)+1:this.count=-1),this.count--,this.s}}class _r extends pr{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=yr(this);const t=Ys(this.s);this.count=1,t&&(this.s=-this.s,this.count=$(this)+2)}return this.count--,this.s}}class rs extends pr{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=yr(this),n=t&1;this.diff=Ie(t/2),this.count=1,n&&(this.count=$(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ic{constructor(t){this.decoder=new _r(t),this.str=Me(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Tc=crypto.getRandomValues.bind(crypto),li=()=>Tc(new Uint32Array(1))[0],Mc=[1e7]+-1e3+-4e3+-8e3+-1e11,Rc=()=>Mc.replace(/[018]/g,e=>(e^li()&15>>e/4).toString(16)),Ge=Date.now,ai=e=>new Promise(e);Promise.all.bind(Promise);const ui=e=>e===void 0?null:e;class jc{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let hi=new jc,ss=!0;try{typeof localStorage<"u"&&localStorage&&(hi=localStorage,ss=!1)}catch{}const fi=hi,Nc=e=>ss||addEventListener("storage",e),Uc=e=>ss||removeEventListener("storage",e),Bc=Object.assign,di=Object.keys,Fc=(e,t)=>{for(const n in e)t(e[n],n)},Vc=(e,t)=>{const n=[];for(const r in e)n.push(t(e[r],r));return n},gi=e=>di(e).length,pi=e=>di(e).length,zc=e=>{for(const t in e)return!1;return!0},qc=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},yi=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Pc=(e,t)=>e===t||pi(e)===pi(t)&&qc(e,(n,r)=>(n!==void 0||yi(t,r))&&t[r]===n),Hc=Object.freeze,_i=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&_i(e[t])}return Hc(e)},is=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&is(e,t,n+1)}},mi=e=>e,$c=(e,t)=>e===t,Gn=(e,t)=>{if(e==null||t==null)return $c(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Gn(e.get(n),t.get(n)))return!1;break}case Object:if(gi(e)!==gi(t))return!1;for(const n in e)if(!yi(e,n)||!Gn(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Gn(e[n],t[n]))return!1;break;default:return!1}return!0},Gc=(e,t)=>t.includes(e),We=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",wi=typeof window<"u"&&typeof document<"u"&&!We;let ve;const Wc=()=>{if(ve===void 0)if(We){ve=bt();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&ve.set(t,""),t=r):t!==null&&(ve.set(t,r),t=null)}t!==null&&ve.set(t,"")}else typeof location=="object"?(ve=bt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");ve.set(`--${Zs(t,"-")}`,n),ve.set(`-${Zs(t,"-")}`,n)}})):ve=bt();return ve},os=e=>Wc().has(e),mr=e=>ui(We?process.env[e.toUpperCase().replaceAll("-","_")]:fi.getItem(e)),bi=e=>os("--"+e)||mr(e)!==null;bi("production");const Jc=We&&Gc(process.env.FORCE_COLOR,["true","1","2"])||!os("--no-colors")&&!bi("no-color")&&(!We||process.stdout.isTTY)&&(!We||os("--color")||mr("COLORTERM")!==null||(mr("TERM")||"").includes("color")),vi=e=>new Uint8Array(e),Yc=(e,t,n)=>new Uint8Array(e,t,n),Xc=e=>new Uint8Array(e),Kc=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=hc(e[n]);return btoa(t)},Qc=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),Zc=e=>{const t=atob(e),n=vi(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},tl=e=>{const t=Buffer.from(e,"base64");return Yc(t.buffer,t.byteOffset,t.byteLength)},el=wi?Kc:Qc,nl=wi?Zc:tl,rl=e=>{const t=vi(e.byteLength);return t.set(e),t};class sl{constructor(t,n){this.left=t,this.right=n}}const Re=(e,t)=>new sl(e,t);typeof DOMParser<"u"&&new DOMParser;const il=e=>nc(e,(t,n)=>`${n}:${t};`).join(""),je=Symbol,Si=je(),ki=je(),ol=je(),cl=je(),ll=je(),Ci=je(),al=je(),cs=je(),ul=je(),hl=e=>{var s;e.length===1&&((s=e[0])==null?void 0:s.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const i=e[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)t.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const i=e[r];i instanceof Symbol||n.push(i)}return n},fl={[Si]:Re("font-weight","bold"),[ki]:Re("font-weight","normal"),[ol]:Re("color","blue"),[ll]:Re("color","green"),[cl]:Re("color","grey"),[Ci]:Re("color","red"),[al]:Re("color","purple"),[cs]:Re("color","orange"),[ul]:Re("color","black")},Ei=Jc?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=bt();let s=[],i=0;for(;i<e.length;i++){const c=e[i],l=fl[c];if(l!==void 0)r.set(l.left,l.right);else{if(c===void 0)break;if(c.constructor===String||c.constructor===Number){const u=il(r);i>0||u.length>0?(t.push("%c"+c),n.push(u)):t.push(c)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const c=e[i];c instanceof Symbol||s.push(c)}return s}:hl,ls=(...e)=>{console.log(...Ei(e)),Di.forEach(t=>t.print(e))},Ai=(...e)=>{console.warn(...Ei(e)),e.unshift(cs),Di.forEach(t=>t.print(e))},Di=Pe(),Oi=e=>({[Symbol.iterator](){return this},next:e}),dl=(e,t)=>Oi(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),as=(e,t)=>Oi(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class gl extends ur{constructor(t,n){super(),this.doc=t,this.awareness=n}}class us{constructor(t,n){this.clock=t,this.len=n}}class Dn{constructor(){this.clients=new Map}}const hn=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const c=r[o];Yi(e,i,c.clock,c.len,n)}}),pl=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=Ie((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},fn=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&pl(n,t.clock)!==null},hs=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=an(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},dn=e=>{const t=new Dn;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let o=n+1;o<e.length;o++)sc(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return hs(t),t},Wn=(e,t,n,r)=>{Jt(e.clients,t,()=>[]).push(new us(n,r))},wr=()=>new Dn,fs=e=>{const t=wr();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const c=o.id.clock;let l=o.length;if(i+1<n.length)for(let u=n[i+1];i+1<n.length&&u.deleted;u=n[++i+1])l+=u.length;s.push(new us(c,l))}}s.length>0&&t.clients.set(r,s)}),t},Se=(e,t)=>{U(e.restEncoder,t.clients.size),xe(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),U(e.restEncoder,n);const s=r.length;U(e.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Ne=e=>{const t=new Dn,n=$(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=$(e.restDecoder),i=$(e.restDecoder);if(i>0){const o=Jt(t.clients,s,()=>[]);for(let c=0;c<i;c++)o.push(new us(e.readDsClock(),e.readDsLen()))}}return t},Li=(e,t,n)=>{const r=new Dn,s=$(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const o=$(e.restDecoder),c=$(e.restDecoder),l=n.clients.get(o)||[],u=_t(n,o);for(let a=0;a<c;a++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<u){u<d&&Wn(r,o,u,d-u);let g=ae(l,h),y=l[g];for(!y.deleted&&y.id.clock<h&&(l.splice(g+1,0,Mr(t,y,h-y.id.clock)),g++);g<l.length&&(y=l[g++],y.id.clock<d);)y.deleted||(d<y.id.clock+y.length&&l.splice(g,0,Mr(t,y,d-y.id.clock)),y.delete(t))}else Wn(r,o,h,d-h)}}if(r.clients.size>0){const i=new ge;return U(i.restEncoder,0),Se(i,r),i.toUint8Array()}return null},xi=(e,t)=>{if(e.clients.size!==t.clients.size)return!1;for(const[n,r]of e.clients.entries()){const s=t.clients.get(n);if(s===void 0||r.length!==s.length)return!1;for(let i=0;i<r.length;i++){const o=r[i],c=s[i];if(o.clock!==c.clock||o.len!==c.len)return!1}}return!0},Ii=li;class Je extends ur{constructor({guid:t=Rc(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Ii(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Wi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=ai(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>ai(u=>{const a=h=>{(h===void 0||h===!0)&&(this.off("sync",a),u())};this.on("sync",a)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const t=this._item;t!==null&&!this.shouldLoad&&lt(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(xe(this.subdocs).map(t=>t.guid))}transact(t,n=null){return lt(this,t,n)}get(t,n=xt){const r=Jt(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==xt&&s!==n)if(s===xt){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Ue)}getText(t=""){return this.get(t,_n)}getMap(t=""){return this.get(t,Ze)}getXmlElement(t=""){return this.get(t,nn)}getXmlFragment(t=""){return this.get(t,en)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,xe(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Je({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,lt(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Jn{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $(this.restDecoder)}readDsLen(){return $(this.restDecoder)}}class le extends Jn{readLeftID(){return W($(this.restDecoder),$(this.restDecoder))}readRightID(){return W($(this.restDecoder),$(this.restDecoder))}readClient(){return $(this.restDecoder)}readInfo(){return An(this.restDecoder)}readString(){return Me(this.restDecoder)}readParentInfo(){return $(this.restDecoder)===1}readTypeRef(){return $(this.restDecoder)}readLen(){return $(this.restDecoder)}readAny(){return $n(this.restDecoder)}readBuf(){return rl(Ht(this.restDecoder))}readJSON(){return JSON.parse(Me(this.restDecoder))}readKey(){return Me(this.restDecoder)}}class Ti{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class re extends Ti{constructor(t){super(t),this.keys=[],$(t),this.keyClockDecoder=new rs(Ht(t)),this.clientDecoder=new _r(Ht(t)),this.leftClockDecoder=new rs(Ht(t)),this.rightClockDecoder=new rs(Ht(t)),this.infoDecoder=new ci(Ht(t),An),this.stringDecoder=new Ic(Ht(t)),this.parentInfoDecoder=new ci(Ht(t),An),this.typeRefDecoder=new _r(Ht(t)),this.lenDecoder=new _r(Ht(t))}readLeftID(){return new gn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new gn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return $n(this.restDecoder)}readBuf(){return Ht(this.restDecoder)}readJSON(){return $n(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class On{constructor(){this.restEncoder=Rt()}toUint8Array(){return ft(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){U(this.restEncoder,t)}writeDsLen(t){U(this.restEncoder,t)}}class Ye extends On{writeLeftID(t){U(this.restEncoder,t.client),U(this.restEncoder,t.clock)}writeRightID(t){U(this.restEncoder,t.client),U(this.restEncoder,t.clock)}writeClient(t){U(this.restEncoder,t)}writeInfo(t){qn(this.restEncoder,t)}writeString(t){He(this.restEncoder,t)}writeParentInfo(t){U(this.restEncoder,t?1:0)}writeTypeRef(t){U(this.restEncoder,t)}writeLen(t){U(this.restEncoder,t)}writeAny(t){Hn(this.restEncoder,t)}writeBuf(t){Ct(this.restEncoder,t)}writeJSON(t){He(this.restEncoder,JSON.stringify(t))}writeKey(t){He(this.restEncoder,t)}}class br{constructor(){this.restEncoder=Rt(),this.dsCurrVal=0}toUint8Array(){return ft(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,U(this.restEncoder,n)}writeDsLen(t){t===0&&Zt(),U(this.restEncoder,t-1),this.dsCurrVal+=t}}class ge extends br{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new es,this.clientEncoder=new gr,this.leftClockEncoder=new es,this.rightClockEncoder=new es,this.infoEncoder=new ei(qn),this.stringEncoder=new Oc,this.parentInfoEncoder=new ei(qn),this.typeRefEncoder=new gr,this.lenEncoder=new gr}toUint8Array(){const t=Rt();return U(t,0),Ct(t,this.keyClockEncoder.toUint8Array()),Ct(t,this.clientEncoder.toUint8Array()),Ct(t,this.leftClockEncoder.toUint8Array()),Ct(t,this.rightClockEncoder.toUint8Array()),Ct(t,ft(this.infoEncoder)),Ct(t,this.stringEncoder.toUint8Array()),Ct(t,ft(this.parentInfoEncoder)),Ct(t,this.typeRefEncoder.toUint8Array()),Ct(t,this.lenEncoder.toUint8Array()),Pn(t,ft(this.restEncoder)),ft(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Hn(this.restEncoder,t)}writeBuf(t){Ct(this.restEncoder,t)}writeJSON(t){Hn(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const yl=(e,t,n,r)=>{r=an(r,t[0].id.clock);const s=ae(t,r);U(e.restEncoder,t.length-s),e.writeClient(n),U(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},ds=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{_t(t,i)>s&&r.set(i,s)}),Xn(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),U(e.restEncoder,r.size),xe(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{yl(e,t.clients.get(s),s,i)})},_l=(e,t)=>{const n=bt(),r=$(e.restDecoder);for(let s=0;s<r;s++){const i=$(e.restDecoder),o=new Array(i),c=e.readClient();let l=$(e.restDecoder);n.set(c,{i:0,refs:o});for(let u=0;u<i;u++){const a=e.readInfo();switch(fr&a){case 0:{const h=e.readLen();o[u]=new te(W(c,l),h),l+=h;break}case 10:{const h=$(e.restDecoder);o[u]=new Yt(W(c,l),h),l+=h;break}default:{const h=(a&(Te|ne))===0,d=new ct(W(c,l),null,(a&ne)===ne?e.readLeftID():null,null,(a&Te)===Te?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(a&Bn)===Bn?e.readString():null,zo(e,a));o[u]=d,l+=d.length}}}}return n},ml=(e,t,n)=>{const r=[];let s=xe(n.keys()).sort((g,y)=>g-y);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let g=n.get(s[s.length-1]);for(;g.refs.length===g.i;)if(s.pop(),s.length>0)g=n.get(s[s.length-1]);else return null;return g};let o=i();if(o===null)return null;const c=new Wi,l=new Map,u=(g,y)=>{const E=l.get(g);(E==null||E>y)&&l.set(g,y)};let a=o.refs[o.i++];const h=new Map,d=()=>{for(const g of r){const y=g.id.client,E=n.get(y);E?(E.i--,c.clients.set(y,E.refs.slice(E.i)),n.delete(y),E.i=0,E.refs=[]):c.clients.set(y,[g]),s=s.filter(D=>D!==y)}r.length=0};for(;;){if(a.constructor!==Yt){const y=Jt(h,a.id.client,()=>_t(t,a.id.client))-a.id.clock;if(y<0)r.push(a),u(a.id.client,a.id.clock-1),d();else{const E=a.getMissing(e,t);if(E!==null){r.push(a);const D=n.get(E)||{refs:[],i:0};if(D.refs.length===D.i)u(E,_t(t,E)),d();else{a=D.refs[D.i++];continue}}else(y===0||y<a.length)&&(a.integrate(e,y),h.set(a.id.client,a.id.clock+a.length))}}if(r.length>0)a=r.pop();else if(o!==null&&o.i<o.refs.length)a=o.refs[o.i++];else{if(o=i(),o===null)break;a=o.refs[o.i++]}}if(c.clients.size>0){const g=new ge;return ds(g,c,new Map),U(g.restEncoder,0),{missing:l,update:g.toUint8Array()}}return null},wl=(e,t)=>ds(e,t.doc.store,t.beforeState),gs=(e,t,n,r=new re(e))=>lt(t,s=>{s.local=!1;let i=!1;const o=s.doc,c=o.store,l=_l(r,o),u=ml(s,c,l),a=c.pendingStructs;if(a){for(const[d,g]of a.missing)if(g<_t(c,d)){i=!0;break}if(u){for(const[d,g]of u.missing){const y=a.missing.get(d);(y==null||y>g)&&a.missing.set(d,g)}a.update=Kn([a.update,u.update])}}else c.pendingStructs=u;const h=Li(r,s,c);if(c.pendingDs){const d=new re(Nt(c.pendingDs));$(d.restDecoder);const g=Li(d,s,c);h&&g?c.pendingDs=Kn([h,g]):c.pendingDs=h||g}else c.pendingDs=h;if(i){const d=c.pendingStructs.update;c.pendingStructs=null,vr(s.doc,d)}},n,!1),bl=(e,t,n)=>gs(e,t,n,new le(e)),vr=(e,t,n,r=re)=>{const s=Nt(t);gs(s,e,n,new r(s))},Mi=(e,t,n)=>vr(e,t,n,le),vl=(e,t,n=new Map)=>{ds(e,t.store,n),Se(e,fs(t.store))},Ri=(e,t=new Uint8Array([0]),n=new ge)=>{const r=ps(t);vl(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Os(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Ye)return oo(s.map((i,o)=>o===0?i:ho(i)));if(n.constructor===ge)return Kn(s)}return s[0]},ji=(e,t)=>Ri(e,t,new Ye),Ni=e=>{const t=new Map,n=$(e.restDecoder);for(let r=0;r<n;r++){const s=$(e.restDecoder),i=$(e.restDecoder);t.set(s,i)}return t},ps=e=>Ni(new Jn(Nt(e))),ys=(e,t)=>(U(e.restEncoder,t.size),xe(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{U(e.restEncoder,n),U(e.restEncoder,r)}),e),Sl=(e,t)=>ys(e,Xn(t.store)),kl=(e,t=new br)=>(e instanceof Map?ys(t,e):Sl(t,e),t.toUint8Array()),Ui=e=>kl(e,new On);class Cl{constructor(){this.l=[]}}const Bi=()=>new Cl,Fi=(e,t)=>e.l.push(t),Vi=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},zi=(e,t,n)=>is(e.l,[t,n]);class gn{constructor(t,n){this.client=t,this.clock=n}}const pn=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,W=(e,t)=>new gn(e,t),qi=(e,t)=>{U(e,t.client),U(e,t.clock)},Pi=e=>W($(e),$(e)),_s=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Zt()},Yn=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},El=e=>{const t=[];let n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))};class Al{constructor(t,n=t.getMap("users")){const r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;const s=(i,o)=>{const c=i.get("ds"),l=i.get("ids"),u=a=>this.clients.set(a,o);c.observe(a=>{a.changes.added.forEach(h=>{h.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(o,dn([this.dss.get(o)||wr(),Ne(new Jn(Nt(d)))]))})})}),this.dss.set(o,dn(c.map(a=>Ne(new Jn(Nt(a)))))),l.observe(a=>a.changes.added.forEach(h=>h.content.getContent().forEach(u))),l.forEach(u)};n.observe(i=>{i.keysChanged.forEach(o=>s(n.get(o),o))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){const i=this.yusers;let o=i.get(r);o||(o=new Ze,o.set("ids",new Ue),o.set("ds",new Ue),i.set(r,o)),o.get("ids").push([n]),i.observe(c=>{setTimeout(()=>{const l=i.get(r);if(l!==o){o=l,this.clients.forEach((h,d)=>{r===h&&o.get("ids").push([d])});const u=new On,a=this.dss.get(r);a&&(Se(u,a),o.get("ds").push([u.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{const l=o.get("ds"),u=c.deleteSet;if(c.local&&u.clients.size>0&&s(c,u)){const a=new On;Se(a,u),l.push([a.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[n,r]of this.dss.entries())if(fn(r,t))return n;return null}}class Sr{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}}const Dl=e=>{const t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},ms=e=>new Sr(e.type==null?null:W(e.type.client,e.type.clock),e.tname??null,e.item==null?null:W(e.item.client,e.item.clock),e.assoc==null?0:e.assoc);class Hi{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}}const Ol=(e,t,n=0)=>new Hi(e,t,n),kr=(e,t,n)=>{let r=null,s=null;return e._item===null?s=_s(e):r=W(e._item.id.client,e._item.id.clock),new Sr(r,s,t,n)},ws=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return kr(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return kr(e,W(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return kr(e,r.lastId,n);r=r.right}return kr(e,null,n)},Ll=(e,t)=>{const{type:n,tname:r,item:s,assoc:i}=t;if(s!==null)U(e,0),qi(e,s);else if(r!==null)qn(e,1),He(e,r);else if(n!==null)qn(e,2),qi(e,n);else throw Zt();return dr(e,i),e},xl=e=>{const t=Rt();return Ll(t,e),ft(t)},Il=e=>{let t=null,n=null,r=null;switch($(e)){case 0:r=Pi(e);break;case 1:n=Me(e);break;case 2:t=Pi(e)}const s=oi(e)?yr(e):0;return new Sr(t,n,r,s)},Tl=e=>Il(Nt(e)),Ml=(e,t)=>{const n=yn(e,t),r=t.clock-n.id.clock;return{item:n,diff:r}},bs=(e,t,n=!0)=>{const r=t.store,s=e.item,i=e.type,o=e.tname,c=e.assoc;let l=null,u=0;if(s!==null){if(_t(r,s.client)<=s.clock)return null;const a=n?Ns(r,s):Ml(r,s),h=a.item;if(!(h instanceof ct))return null;if(l=h.parent,l._item===null||!l._item.deleted){u=h.deleted||!h.countable?0:a.diff+(c>=0?0:1);let d=h.left;for(;d!==null;)!d.deleted&&d.countable&&(u+=d.length),d=d.left}}else{if(o!==null)l=t.get(o);else if(i!==null){if(_t(r,i.client)<=i.clock)return null;const{item:a}=n?Ns(r,i):{item:yn(r,i)};if(a instanceof ct&&a.content instanceof he)l=a.content.type;else return null}else throw Zt();c>=0?u=l._length:u=0}return Ol(l,u,e.assoc)},vs=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&pn(e.item,t.item)&&pn(e.type,t.type)&&e.assoc===t.assoc;class Ss{constructor(t,n){this.ds=t,this.sv=n}}const Rl=(e,t)=>{const n=e.ds.clients,r=t.ds.clients,s=e.sv,i=t.sv;if(s.size!==i.size||n.size!==r.size)return!1;for(const[o,c]of s.entries())if(i.get(o)!==c)return!1;for(const[o,c]of n.entries()){const l=r.get(o)||[];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const a=c[u],h=l[u];if(a.clock!==h.clock||a.len!==h.len)return!1}}return!0},$i=(e,t=new br)=>(Se(t,e.ds),ys(t,e.sv),t.toUint8Array()),jl=e=>$i(e,new On),Gi=(e,t=new Ti(Nt(e)))=>new Ss(Ne(t),Ni(t)),Nl=e=>Gi(e,new Jn(Nt(e))),ks=(e,t)=>new Ss(e,t),Ul=ks(wr(),new Map),Bl=e=>ks(fs(e.store),Xn(e.store)),Xe=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!fn(t.ds,e.id),Cs=(e,t)=>{const n=Jt(e.meta,Cs,Pe),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<_t(r,i)&&$t(e,W(i,s))}),hn(e,t.ds,s=>{}),n.add(t))},Fl=(e,t,n=new Je)=>{if(e.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:r,ds:s}=t,i=new ge;return e.transact(o=>{let c=0;r.forEach(l=>{l>0&&c++}),U(i.restEncoder,c);for(const[l,u]of r){if(u===0)continue;u<_t(e.store,l)&&$t(o,W(l,u));const a=e.store.clients.get(l)||[],h=ae(a,u-1);U(i.restEncoder,h+1),i.writeClient(l),U(i.restEncoder,0);for(let d=0;d<=h;d++)a[d].write(i,0)}Se(i,s)}),vr(n,i.toUint8Array(),"snapshot"),n},Vl=(e,t,n=re)=>{const r=new n(Nt(t)),s=new Ke(r,!1);for(let o=s.curr;o!==null;o=s.next())if((e.sv.get(o.id.client)||0)<o.id.clock+o.length)return!1;const i=dn([e.ds,Ne(r)]);return xi(e.ds,i)},zl=(e,t)=>Vl(e,t,le);class Wi{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Xn=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},_t=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Ji=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Zt()}n.push(t)},ae=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=Ie(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=Ie((n+r)/2)}throw Zt()},yn=(e,t)=>{const n=e.clients.get(t.client);return n[ae(n,t.clock)]},Es=(e,t,n)=>{const r=ae(t,n),s=t[r];return s.id.clock<n&&s instanceof ct?(t.splice(r+1,0,Mr(e,s,n-s.id.clock)),r+1):r},$t=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Es(e,n,t.clock)]},As=(e,t,n)=>{const r=t.clients.get(n.client),s=ae(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==te&&r.splice(s+1,0,Mr(e,i,n.clock-i.id.clock+1)),i},ql=(e,t,n)=>{const r=e.clients.get(t.id.client);r[ae(r,t.id.clock)]=n},Yi=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let o=Es(e,t,n),c;do c=t[o++],i<c.id.clock+c.length&&Es(e,t,i),s(c);while(o<t.length&&t[o].id.clock<i)};class Xi{constructor(t,n,r){this.doc=t,this.deleteSet=new Dn,this.beforeState=Xn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ki=(e,t)=>t.deleteSet.clients.size===0&&!rc(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(hs(t.deleteSet),wl(e,t),Se(e,t.deleteSet),!0),Qi=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Jt(e.changed,t,Pe).add(n)},Cr=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ct&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},Zi=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){const c=s[o],l=c.clock+c.len;for(let u=ae(i,c.clock),a=i[u];u<i.length&&a.id.clock<l;a=i[++u]){const h=i[u];if(c.clock+c.len<=h.id.clock)break;h instanceof ct&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},to=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],c=Jr(s.length-1,1+ae(s,o.clock+o.len-1));for(let l=c,u=s[l];l>0&&u.id.clock>=o.clock;u=s[l])l-=1+Cr(s,l)}})},Pl=(e,t,n)=>{Zi(e,t,n),to(e,t)},eo=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{hs(i),n.afterState=Xn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const c=[];n.changed.forEach((l,u)=>c.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(a=>a.target._item===null||!a.target._item.deleted),l.forEach(a=>{a.currentTarget=u,a._path=null}),l.sort((a,h)=>a.path.length-h.path.length),zi(u._dEH,l,n))})}),c.push(()=>r.emit("afterTransaction",[n,r])),is(c,[]),n._needFormattingCleanup&&ga(n)}finally{r.gc&&Zi(i,s,r.gcFilter),to(i,s),n.afterState.forEach((a,h)=>{const d=n.beforeState.get(h)||0;if(d!==a){const g=s.clients.get(h),y=an(ae(g,d),1);for(let E=g.length-1;E>=y;)E-=1+Cr(g,E)}});for(let a=o.length-1;a>=0;a--){const{client:h,clock:d}=o[a].id,g=s.clients.get(h),y=ae(g,d);y+1<g.length&&Cr(g,y+1)>1||y>0&&Cr(g,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(ls(cs,Si,"[yjs] ",ki,Ci,"Changed the client-id because another client seems to be using it."),r.clientID=Ii()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const a=new Ye;Ki(a,n)&&r.emit("update",[a.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const a=new ge;Ki(a,n)&&r.emit("updateV2",[a.toUint8Array(),n.origin,r,n])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:u}=n;(c.size>0||u.size>0||l.size>0)&&(c.forEach(a=>{a.clientID=r.clientID,a.collectionid==null&&(a.collectionid=r.collectionid),r.subdocs.add(a)}),u.forEach(a=>r.subdocs.delete(a)),r.emit("subdocs",[{loaded:l,added:c,removed:u},r,n]),u.forEach(a=>a.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):eo(e,t+1)}}},lt=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new Xi(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const c=e._transaction===s[0];e._transaction=null,c&&eo(s,0)}}return o};class Hl{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const no=(e,t,n)=>{hn(e,n.deletions,r=>{r instanceof ct&&t.scope.some(s=>s===e.doc||Yn(s,r))&&Us(r,!1)})},ro=(e,t,n)=>{let r=null;const s=e.doc,i=e.scope;lt(s,c=>{for(;t.length>0&&e.currStackItem===null;){const l=s.store,u=t.pop(),a=new Set,h=[];let d=!1;hn(c,u.insertions,g=>{if(g instanceof ct){if(g.redone!==null){let{item:y,diff:E}=Ns(l,g.id);E>0&&(y=$t(c,W(y.id.client,y.id.clock+E))),g=y}!g.deleted&&i.some(y=>y===c.doc||Yn(y,g))&&h.push(g)}}),hn(c,u.deletions,g=>{g instanceof ct&&i.some(y=>y===c.doc||Yn(y,g))&&!fn(u.insertions,g.id)&&a.add(g)}),a.forEach(g=>{d=Vo(c,g,a,u.insertions,e.ignoreRemoteMapChanges,e)!==null||d});for(let g=h.length-1;g>=0;g--){const y=h[g];e.deleteFilter(y)&&(y.delete(c),d=!0)}e.currStackItem=d?u:null}c.changed.forEach((l,u)=>{l.has(null)&&u._searchMarker&&(u._searchMarker.length=0)}),r=c},e);const o=e.currStackItem;if(o!=null){const c=r.changedParentTypes;e.emit("stack-item-popped",[{stackItem:o,type:n,changedParentTypes:c,origin:e},e]),e.currStackItem=null}return o};class $l extends ur{constructor(t,{captureTimeout:n=500,captureTransaction:r=l=>!0,deleteFilter:s=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=Wr(t)?t[0].doc:t instanceof Je?t:t.doc}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=s,i.add(this),this.trackedOrigins=i,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(D=>l.changedParentTypes.has(D)||D===this.doc)||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;const u=this.undoing,a=this.redoing,h=u?this.redoStack:this.undoStack;u?this.stopCapturing():a||this.clear(!1,!0);const d=new Dn;l.afterState.forEach((D,S)=>{const _=l.beforeState.get(S)||0,f=D-_;f>0&&Wn(d,S,_,f)});const g=Ge();let y=!1;if(this.lastChange>0&&g-this.lastChange<this.captureTimeout&&h.length>0&&!u&&!a){const D=h[h.length-1];D.deletions=dn([D.deletions,l.deleteSet]),D.insertions=dn([D.insertions,d])}else h.push(new Hl(l.deleteSet,d)),y=!0;!u&&!a&&(this.lastChange=g),hn(l,l.deleteSet,D=>{D instanceof ct&&this.scope.some(S=>S===l.doc||Yn(S,D))&&Us(D,!0)});const E=[{stackItem:h[h.length-1],origin:l.origin,type:u?"redo":"undo",changedParentTypes:l.changedParentTypes},this];y?this.emit("stack-item-added",E):this.emit("stack-item-updated",E)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){const n=new Set(this.scope);t=Wr(t)?t:[t],t.forEach(r=>{n.has(r)||(n.add(r),(r instanceof xt?r.doc!==this.doc:r!==this.doc)&&Ai("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>no(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>no(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=ro(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=ro(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Gl(e){const t=$(e.restDecoder);for(let n=0;n<t;n++){const r=$(e.restDecoder),s=e.readClient();let i=$(e.restDecoder);for(let o=0;o<r;o++){const c=e.readInfo();if(c===10){const l=$(e.restDecoder);yield new Yt(W(s,i),l),i+=l}else if(fr&c){const l=(c&(Te|ne))===0,u=new ct(W(s,i),null,(c&ne)===ne?e.readLeftID():null,null,(c&Te)===Te?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&Bn)===Bn?e.readString():null,zo(e,c));yield u,i+=u.length}else{const l=e.readLen();yield new te(W(s,i),l),i+=l}}}}class Ke{constructor(t,n){this.gen=Gl(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Yt);return this.curr}}const Wl=e=>so(e,le),so=(e,t=re)=>{const n=[],r=new t(Nt(e)),s=new Ke(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);ls("Structs: ",n);const i=Ne(r);ls("DeleteSet: ",i)},Jl=e=>io(e,le),io=(e,t=re)=>{const n=[],r=new t(Nt(e)),s=new Ke(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);return{structs:n,ds:Ne(r)}};class Ds{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const oo=e=>Kn(e,le,Ye),co=(e,t=br,n=re)=>{const r=new t,s=new Ke(new n(Nt(e)),!1);let i=s.curr;if(i!==null){let o=0,c=i.id.client,l=i.id.clock!==0,u=l?0:i.id.clock+i.length;for(;i!==null;i=s.next())c!==i.id.client&&(u!==0&&(o++,U(r.restEncoder,c),U(r.restEncoder,u)),c=i.id.client,u=0,l=i.id.clock!==0),i.constructor===Yt&&(l=!0),l||(u=i.id.clock+i.length);u!==0&&(o++,U(r.restEncoder,c),U(r.restEncoder,u));const a=Rt();return U(a,o),kc(a,r.restEncoder),r.restEncoder=a,r.toUint8Array()}else return U(r.restEncoder,0),r.toUint8Array()},Yl=e=>co(e,On,le),lo=(e,t=re)=>{const n=new Map,r=new Map,s=new Ke(new t(Nt(e)),!1);let i=s.curr;if(i!==null){let o=i.id.client,c=i.id.clock;for(n.set(o,c);i!==null;i=s.next())o!==i.id.client&&(r.set(o,c),n.set(i.id.client,i.id.clock),o=i.id.client),c=i.id.clock+i.length;r.set(o,c)}return{from:n,to:r}},Xl=e=>lo(e,le),Kl=(e,t)=>{if(e.constructor===te){const{client:n,clock:r}=e.id;return new te(W(n,r+t),e.length-t)}else if(e.constructor===Yt){const{client:n,clock:r}=e.id;return new Yt(W(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new ct(W(r,s+t),null,W(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Kn=(e,t=re,n=ge)=>{if(e.length===1)return e[0];const r=e.map(a=>new t(Nt(a)));let s=r.map(a=>new Ke(a,!0)),i=null;const o=new n,c=new Ds(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,g)=>{if(d.curr.id.client===g.curr.id.client){const y=d.curr.id.clock-g.curr.id.clock;return y===0?d.curr.constructor===g.curr.constructor?0:d.curr.constructor===Yt?1:-1:y}else return g.curr.id.client-d.curr.id.client}),s.length!==0;){const a=s[0],h=a.curr.id.client;if(i!==null){let d=a.curr,g=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=a.next(),g=!0;if(d===null||d.id.client!==h||g&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Qe(c,i.struct,i.offset),i={struct:d,offset:0},a.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===Yt)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{Qe(c,i.struct,i.offset);const y=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Yt(W(h,i.struct.id.clock+i.struct.length),y),offset:0}}else{const y=i.struct.id.clock+i.struct.length-d.id.clock;y>0&&(i.struct.constructor===Yt?i.struct.length-=y:d=Kl(d,y)),i.struct.mergeWith(d)||(Qe(c,i.struct,i.offset),i={struct:d,offset:0},a.next())}}else i={struct:a.curr,offset:0},a.next();for(let d=a.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==Yt;d=a.next())Qe(c,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(Qe(c,i.struct,i.offset),i=null),Ls(c);const l=r.map(a=>Ne(a)),u=dn(l);return Se(o,u),o.toUint8Array()},Os=(e,t,n=re,r=ge)=>{const s=ps(t),i=new r,o=new Ds(i),c=new n(Nt(e)),l=new Ke(c,!1);for(;l.curr;){const a=l.curr,h=a.id.client,d=s.get(h)||0;if(l.curr.constructor===Yt){l.next();continue}if(a.id.clock+a.length>d)for(Qe(o,a,an(d-a.id.clock,0)),l.next();l.curr&&l.curr.id.client===h;)Qe(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===h&&l.curr.id.clock+l.curr.length<=d;)l.next()}Ls(o);const u=Ne(c);return Se(i,u),i.toUint8Array()},Ql=(e,t)=>Os(e,t,le,Ye),ao=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:ft(e.encoder.restEncoder)}),e.encoder.restEncoder=Rt(),e.written=0)},Qe=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&ao(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),U(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Ls=e=>{ao(e);const t=e.encoder.restEncoder;U(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];U(t,r.written),Pn(t,r.restEncoder)}},Er=(e,t,n,r)=>{const s=new n(Nt(e)),i=new Ke(s,!1),o=new r,c=new Ds(o);for(let u=i.curr;u!==null;u=i.next())Qe(c,t(u),0);Ls(c);const l=Ne(s);return Se(o,l),o.toUint8Array()},uo=({formatting:e=!0,subdocs:t=!0,yxml:n=!0}={})=>{let r=0;const s=bt(),i=bt(),o=bt(),c=bt();return c.set(null,null),l=>{switch(l.constructor){case te:case Yt:return l;case ct:{const u=l,a=u.content;switch(a.constructor){case wn:break;case he:{if(n){const h=a.type;h instanceof nn&&(h.nodeName=Jt(i,h.nodeName,()=>"node-"+r)),h instanceof xn&&(h.hookName=Jt(i,h.hookName,()=>"hook-"+r))}break}case Fe:{const h=a;h.arr=h.arr.map(()=>r);break}case mn:{const h=a;h.content=new Uint8Array([r]);break}case bn:{const h=a;t&&(h.opts={},h.doc.guid=r+"");break}case Be:{const h=a;h.embed={};break}case Et:{const h=a;e&&(h.key=Jt(o,h.key,()=>r+""),h.value=Jt(c,h.value,()=>({i:r})));break}case In:{const h=a;h.arr=h.arr.map(()=>r);break}case ue:{const h=a;h.str=mc(r%10+"",h.str.length);break}default:Zt()}return u.parentSub&&(u.parentSub=Jt(s,u.parentSub,()=>r+"")),r++,l}default:Zt()}}},Zl=(e,t)=>Er(e,uo(t),le,Ye),ta=(e,t)=>Er(e,uo(t),re,ge),ea=e=>Er(e,mi,le,ge),ho=e=>Er(e,mi,re,Ye),fo="You must not compute changes after the event-handler fired.";class Qn{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=na(this.currentTarget,this.target))}deletes(t){return fn(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw $e(fo);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,c;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",c=Gr(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",c=Gr(l.content.getContent())):(o="add",c=void 0)}else if(this.deletes(i))o="delete",c=Gr(i.content.getContent());else return;t.set(s,{action:o,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw $e(fo);const n=this.target,r=Pe(),s=Pe(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const l=()=>{c&&i.push(c)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=u.length,s.add(u)):this.adds(u)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(u.content.getContent()),r.add(u)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=u.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}}const na=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},Ft=()=>{Ai("Invalid access: Add Yjs type to a document before reading data.")},go=80;let xs=0;class ra{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=xs++}}const sa=e=>{e.timestamp=xs++},po=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=xs++},ia=(e,t,n)=>{if(e.length>=go){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return po(r,t,n),r}else{const r=new ra(t,n);return e.push(r),r}},Ar=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>hr(t-i.index)<hr(t-o.index)?i:o);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,sa(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&hr(n.index-s)<r.parent.length/go?(po(n,r,s),n):ia(e._searchMarker,r,s)},Zn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=an(t,s.index+n))}},oa=e=>{e.doc??Ft();let t=e._start;const n=[];for(;t;)n.push(t),t=t.right;return n},Dr=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;Jt(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;zi(r._eH,n,t)};class xt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Bi(),this._dEH=Bi(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw be()}clone(){throw be()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Fi(this._eH,t)}observeDeep(t){Fi(this._dEH,t)}unobserve(t){Vi(this._eH,t)}unobserveDeep(t){Vi(this._dEH,t)}toJSON(){}}const yo=(e,t,n)=>{e.doc??Ft(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let c=t;c<o.length&&r>0;c++)s.push(o[c]),r--;t=0}}i=i.right}return s},_o=e=>{e.doc??Ft();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},ca=(e,t)=>{const n=[];let r=e._start;for(;r!==null;){if(r.countable&&Xe(r,t)){const s=r.content.getContent();for(let i=0;i<s.length;i++)n.push(s[i])}r=r.right}return n},tr=(e,t)=>{let n=0,r=e._start;for(e.doc??Ft();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},mo=(e,t)=>{const n=[];return tr(e,(r,s)=>{n.push(t(r,s,e))}),n},la=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},wo=(e,t)=>{e.doc??Ft();const n=Ar(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Or=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,c=i.store,l=n===null?t._start:n.right;let u=[];const a=()=>{u.length>0&&(s=new ct(W(o,_t(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new Fe(u)),s.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(a(),h.constructor){case Uint8Array:case ArrayBuffer:s=new ct(W(o,_t(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new mn(new Uint8Array(h))),s.integrate(e,0);break;case Je:s=new ct(W(o,_t(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new bn(h)),s.integrate(e,0);break;default:if(h instanceof xt)s=new ct(W(o,_t(c,o)),s,s&&s.lastId,l,l&&l.id,t,null,new he(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),a()},bo=()=>$e("Length exceeded!"),vo=(e,t,n,r)=>{if(n>t._length)throw bo();if(n===0)return t._searchMarker&&Zn(t._searchMarker,n,r.length),Or(e,t,null,r);const s=n,i=Ar(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&$t(e,W(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Zn(t._searchMarker,s,r.length),Or(e,t,o,r)},aa=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Or(e,t,s,n)},So=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,o=Ar(t,n);let c=t._start;for(o!==null&&(c=o.p,n-=o.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&$t(e,W(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&$t(e,W(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw bo();t._searchMarker&&Zn(t._searchMarker,s,-i+r)},Lr=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Is=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let c;if(r==null)c=new Fe([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new Fe([r]);break;case Uint8Array:c=new mn(r);break;case Je:c=new bn(r);break;default:if(r instanceof xt)c=new he(r);else throw new Error("Unexpected content type")}new ct(W(o,_t(i.store,o)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},Ts=(e,t)=>{e.doc??Ft();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},ko=e=>{const t={};return e.doc??Ft(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Co=(e,t)=>{e.doc??Ft();const n=e._map.get(t);return n!==void 0&&!n.deleted},ua=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&Xe(r,n)?r.content.getContent()[r.length-1]:void 0},Eo=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&Xe(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},xr=e=>(e.doc??Ft(),dl(e._map.entries(),t=>!t[1].deleted));class Ao extends Qn{}class Ue extends xt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ue;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ue}clone(){const t=new Ue;return t.insert(0,this.toArray().map(n=>n instanceof xt?n.clone():n)),t}get length(){return this.doc??Ft(),this._length}_callObserver(t,n){super._callObserver(t,n),Dr(this,t,new Ao(this,t))}insert(t,n){this.doc!==null?lt(this.doc,r=>{vo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?lt(this.doc,n=>{aa(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?lt(this.doc,r=>{So(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return wo(this,t)}toArray(){return _o(this)}slice(t=0,n=this.length){return yo(this,t,n)}toJSON(){return this.map(t=>t instanceof xt?t.toJSON():t)}map(t){return mo(this,t)}forEach(t){tr(this,t)}[Symbol.iterator](){return la(this)}_write(t){t.writeTypeRef(Ia)}}const ha=e=>new Ue;class Do extends Qn{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Ze extends xt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Ze}clone(){const t=new Ze;return this.forEach((n,r)=>{t.set(r,n instanceof xt?n.clone():n)}),t}_callObserver(t,n){Dr(this,t,new Do(this,t,n))}toJSON(){this.doc??Ft();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof xt?s.toJSON():s}}),t}get size(){return[...xr(this)].length}keys(){return as(xr(this),t=>t[0])}values(){return as(xr(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return as(xr(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??Ft(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?lt(this.doc,n=>{Lr(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?lt(this.doc,r=>{Is(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Ts(this,t)}has(t){return Co(this,t)}clear(){this.doc!==null?lt(this.doc,t=>{this.forEach(function(n,r,s){Lr(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ta)}}const fa=e=>new Ze,tn=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Pc(e,t);class Ms{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Zt(),this.right.content.constructor){case Et:this.right.deleted||Ln(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Oo=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Et:t.right.deleted||Ln(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&$t(e,W(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ir=(e,t,n,r)=>{const s=new Map,i=r?Ar(t,n):null;if(i){const o=new Ms(i.p.left,i.p,i.index,s);return Oo(e,o,n-i.index)}else{const o=new Ms(null,t._start,0,s);return Oo(e,o,n)}},Lo=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Et&&tn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((o,c)=>{const l=n.left,u=n.right,a=new ct(W(i,_t(s.store,i)),l,l&&l.lastId,u,u&&u.id,t,null,new Et(c,o));a.integrate(e,0),n.right=a,n.forward()})},Ln=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},xo=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Et&&tn(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Io=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const c in r){const l=r[c],u=n.currentAttributes.get(c)??null;if(!tn(u,l)){o.set(c,u);const{left:a,right:h}=n;n.right=new ct(W(i,_t(s.store,i)),a,a&&a.lastId,h,h&&h.id,t,null,new Et(c,l)),n.right.integrate(e,0),n.forward()}}return o},Rs=(e,t,n,r,s)=>{n.currentAttributes.forEach((d,g)=>{s[g]===void 0&&(s[g]=null)});const i=e.doc,o=i.clientID;xo(n,s);const c=Io(e,t,n,s),l=r.constructor===String?new ue(r):r instanceof xt?new he(r):new Be(r);let{left:u,right:a,index:h}=n;t._searchMarker&&Zn(t._searchMarker,n.index,l.getLength()),a=new ct(W(o,_t(i.store,o)),u,u&&u.lastId,a,a&&a.id,t,null,l),a.integrate(e,0),n.right=a,n.index=h,n.forward(),Lo(e,t,n,c)},To=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;xo(n,s);const c=Io(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===Et));){if(!n.right.deleted)switch(n.right.content.constructor){case Et:{const{key:l,value:u}=n.right.content,a=s[l];if(a!==void 0){if(tn(a,u))c.delete(l);else{if(r===0)break t;c.set(l,u)}n.right.delete(e)}else n.currentAttributes.set(l,u);break}default:r<n.right.length&&$t(e,W(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new ct(W(o,_t(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new ue(l)),n.right.integrate(e,0),n.forward()}Lo(e,t,n,c)},Mo=(e,t,n,r,s)=>{let i=t;const o=bt();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Et){const u=i.content;o.set(u.key,u)}i=i.right}let c=0,l=!1;for(;t!==i;){if(n===t&&(l=!0),!t.deleted){const u=t.content;switch(u.constructor){case Et:{const{key:a,value:h}=u,d=r.get(a)??null;(o.get(a)!==u||d===h)&&(t.delete(e),c++,!l&&(s.get(a)??null)===h&&d!==h&&(d===null?s.delete(a):s.set(a,d))),!l&&!t.deleted&&Ln(s,u);break}}}t=t.right}return c},da=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Et){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Ro=e=>{let t=0;return lt(e.doc,n=>{let r=e._start,s=e._start,i=bt();const o=$r(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Et:Ln(o,s.content);break;default:t+=Mo(n,r,s,i,o),i=$r(o),r=s;break}s=s.right}}),t},ga=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&Yi(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Et&&o.constructor!==te&&t.add(o.parent)})}lt(n,r=>{hn(e,e.deleteSet,s=>{if(s instanceof te||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===Et?t.add(i):da(r,s)});for(const s of t)Ro(s)})},jo=(e,t,n)=>{const r=n,s=$r(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case he:case Be:case ue:n<t.right.length&&$t(e,W(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&Mo(e,i,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Zn(o._searchMarker,t.index,-r+n),t};class No extends Qn{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];lt(t,r=>{const s=new Map,i=new Map;let o=this.target._start,c=null;const l={};let u="",a=0,h=0;const d=()=>{if(c!==null){let g=null;switch(c){case"delete":h>0&&(g={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(g={insert:u},s.size>0&&(g.attributes={},s.forEach((y,E)=>{y!==null&&(g.attributes[E]=y)}))),u="";break;case"retain":a>0&&(g={retain:a},zc(l)||(g.attributes=Bc({},l))),a=0;break}g&&n.push(g),c=null}};for(;o!==null;){switch(o.content.constructor){case he:case Be:this.adds(o)?this.deletes(o)||(d(),c="insert",u=o.content.getContent()[0],d()):this.deletes(o)?(c!=="delete"&&(d(),c="delete"),h+=1):o.deleted||(c!=="retain"&&(d(),c="retain"),a+=1);break;case ue:this.adds(o)?this.deletes(o)||(c!=="insert"&&(d(),c="insert"),u+=o.content.str):this.deletes(o)?(c!=="delete"&&(d(),c="delete"),h+=o.length):o.deleted||(c!=="retain"&&(d(),c="retain"),a+=o.length);break;case Et:{const{key:g,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const E=s.get(g)??null;tn(E,y)?y!==null&&o.delete(r):(c==="retain"&&d(),tn(y,i.get(g)??null)?delete l[g]:l[g]=y)}}else if(this.deletes(o)){i.set(g,y);const E=s.get(g)??null;tn(E,y)||(c==="retain"&&d(),l[g]=E)}else if(!o.deleted){i.set(g,y);const E=l[g];E!==void 0&&(tn(E,y)?E!==null&&o.delete(r):(c==="retain"&&d(),y===null?delete l[g]:l[g]=y))}o.deleted||(c==="insert"&&d(),Ln(s,o.content));break}}o=o.right}for(d();n.length>0;){const g=n[n.length-1];if(g.retain!==void 0&&g.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class _n extends xt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ft(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new _n}clone(){const t=new _n;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new No(this,t,n);Dr(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??Ft();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===ue&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?lt(this.doc,r=>{const s=new Ms(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const c=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&Rs(r,this,s,c,o.attributes||{})}else o.retain!==void 0?To(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&jo(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??Ft();const s=[],i=new Map,o=this.doc;let c="",l=this._start;function u(){if(c.length>0){const h={};let d=!1;i.forEach((y,E)=>{d=!0,h[E]=y});const g={insert:c};d&&(g.attributes=h),s.push(g),c=""}}const a=()=>{for(;l!==null;){if(Xe(l,t)||n!==void 0&&Xe(l,n))switch(l.content.constructor){case ue:{const h=i.get("ychange");t!==void 0&&!Xe(l,t)?(h===void 0||h.user!==l.id.client||h.type!=="removed")&&(u(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!Xe(l,n)?(h===void 0||h.user!==l.id.client||h.type!=="added")&&(u(),i.set("ychange",r?r("added",l.id):{type:"added"})):h!==void 0&&(u(),i.delete("ychange")),c+=l.content.str;break}case he:case Be:{u();const h={insert:l.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((g,y)=>{d[y]=g})}s.push(h);break}case Et:Xe(l,t)&&(u(),Ln(i,l.content));break}l=l.right}u()};return t||n?lt(o,h=>{t&&Cs(h,t),n&&Cs(h,n),a()},"cleanup"):a(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?lt(s,i=>{const o=Ir(i,this,t,!r);r||(r={},o.currentAttributes.forEach((c,l)=>{r[l]=c})),Rs(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?lt(s,i=>{const o=Ir(i,this,t,!r);Rs(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?lt(r,s=>{jo(s,Ir(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?lt(s,i=>{const o=Ir(i,this,t,!1);o.right!==null&&To(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?lt(this.doc,n=>{Lr(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?lt(this.doc,r=>{Is(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Ts(this,t)}getAttributes(){return ko(this)}_write(t){t.writeTypeRef(Ma)}}const pa=e=>new _n;class js{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??Ft()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===nn||n.constructor===en)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class en extends xt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new en}clone(){const t=new en;return t.insert(0,this.toArray().map(n=>n instanceof xt?n.clone():n)),t}get length(){return this.doc??Ft(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new js(this,t)}querySelector(t){t=t.toUpperCase();const r=new js(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),xe(new js(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Dr(this,t,new Uo(this,n,t))}toString(){return mo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),tr(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?lt(this.doc,r=>{vo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)lt(this.doc,r=>{const s=t&&t instanceof xt?t._item:t;Or(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw $e("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?lt(this.doc,r=>{So(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return _o(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return wo(this,t)}slice(t=0,n=this.length){return yo(this,t,n)}forEach(t){tr(this,t)}_write(t){t.writeTypeRef(ja)}}const ya=e=>new en;class nn extends en{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new nn(this.nodeName)}clone(){const t=new nn(this.nodeName),n=this.getAttributes();return Fc(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof xt?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const c in t)r.push(c);r.sort();const s=r.length;for(let c=0;c<s;c++){const l=r[c];n.push(l+'="'+t[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?lt(this.doc,n=>{Lr(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?lt(this.doc,r=>{Is(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Ts(this,t)}hasAttribute(t){return Co(this,t)}getAttributes(t){return t?Eo(this,t):ko(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const c=i[o];typeof c=="string"&&s.setAttribute(o,c)}return tr(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ra),t.writeKey(this.nodeName)}}const _a=e=>new nn(e.readKey());class Uo extends Qn{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class xn extends Ze{constructor(t){super(),this.hookName=t}_copy(){return new xn(this.hookName)}clone(){const t=new xn(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Na),t.writeKey(this.hookName)}}const ma=e=>new xn(e.readKey());class er extends _n{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new er}clone(){const t=new er;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,c)=>o.key<c.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const c=i.attrs[o];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ua)}}const wa=e=>new er;class Tr{constructor(t,n){this.id=t,this.length=n}get deleted(){throw be()}mergeWith(t){return!1}write(t,n,r){throw be()}integrate(t,n){throw be()}}const ba=0;class te extends Tr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ji(t.doc.store,this)}write(t,n){t.writeInfo(ba),t.writeLen(this.length-n)}getMissing(t,n){return null}}class mn{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new mn(this.content)}splice(t){throw be()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const va=e=>new mn(e.readBuf());class wn{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wn(this.len)}splice(t){const n=new wn(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Wn(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Sa=e=>new wn(e.readLen()),Bo=(e,t)=>new Je({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class bn{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new bn(Bo(this.doc.guid,this.opts))}splice(t){throw be()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const ka=e=>new bn(Bo(e.readString(),e.readAny()));class Be{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Be(this.embed)}splice(t){throw be()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Ca=e=>new Be(e.readJSON());class Et{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Et(this.key,this.value)}splice(t){throw be()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Ea=e=>new Et(e.readKey(),e.readJSON());class In{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new In(this.arr)}splice(t){const n=new In(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const Aa=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new In(n)},Da=mr("node_env")==="development";class Fe{constructor(t){this.arr=t,Da&&_i(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Fe(this.arr)}splice(t){const n=new Fe(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const Oa=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Fe(n)};class ue{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ue(this.str)}splice(t){const n=new ue(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const La=e=>new ue(e.readString()),xa=[ha,fa,pa,_a,ya,ma,wa],Ia=0,Ta=1,Ma=2,Ra=3,ja=4,Na=5,Ua=6;class he{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new he(this.type._copy())}splice(t){throw be()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Ba=e=>new he(xa[e.readTypeRef()](e)),Ns=(e,t)=>{let n=t,r=0,s;do r>0&&(n=W(n.client,n.clock+r)),s=yn(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof ct);return{item:s,diff:r}},Us=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},Mr=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new ct(W(r,s+n),t,W(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=W(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i},Fo=(e,t)=>ic(e,n=>fn(n.deletions,t)),Vo=(e,t,n,r,s,i)=>{const o=e.doc,c=o.store,l=o.clientID,u=t.redone;if(u!==null)return $t(e,u);let a=t.parent._item,h=null,d;if(a!==null&&a.deleted===!0){if(a.redone===null&&(!n.has(a)||Vo(e,a,n,r,s,i)===null))return null;for(;a.redone!==null;)a=$t(e,a.redone)}const g=a===null?t.parent:a.content.type;if(t.parentSub===null){for(h=t.left,d=t;h!==null;){let S=h;for(;S!==null&&S.parent._item!==a;)S=S.redone===null?null:$t(e,S.redone);if(S!==null&&S.parent._item===a){h=S;break}h=h.left}for(;d!==null;){let S=d;for(;S!==null&&S.parent._item!==a;)S=S.redone===null?null:$t(e,S.redone);if(S!==null&&S.parent._item===a){d=S;break}d=d.right}}else if(d=null,t.right&&!s){for(h=t;h!==null&&h.right!==null&&(h.right.redone||fn(r,h.right.id)||Fo(i.undoStack,h.right.id)||Fo(i.redoStack,h.right.id));)for(h=h.right;h.redone;)h=$t(e,h.redone);if(h&&h.right!==null)return null}else h=g._map.get(t.parentSub)||null;const y=_t(c,l),E=W(l,y),D=new ct(E,h,h&&h.lastId,d,d&&d.id,g,t.parentSub,t.content.copy());return t.redone=E,Us(D,!0),D.integrate(e,0),D};class ct extends Tr{constructor(t,n,r,s,i,o,c,l){super(t,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?Ks:0}set marker(t){(this.info&Xr)>0!==t&&(this.info^=Xr)}get marker(){return(this.info&Xr)>0}get keep(){return(this.info&Xs)>0}set keep(t){this.keep!==t&&(this.info^=Xs)}get countable(){return(this.info&Ks)>0}get deleted(){return(this.info&Yr)>0}set deleted(t){this.deleted!==t&&(this.info^=Yr)}markDeleted(){this.info|=Yr}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=_t(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=_t(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===gn&&this.id.client!==this.parent.client&&this.parent.clock>=_t(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=As(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=$t(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===te||this.right&&this.right.constructor===te)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ct?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ct&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===gn){const r=yn(n,this.parent);r.constructor===te?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=As(t,t.doc.store,W(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),pn(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(pn(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(yn(t.doc.store,s.origin)))i.has(yn(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ji(t.doc.store,this),this.content.integrate(t,this),Qi(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new te(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:W(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&pn(t.origin,this.lastId)&&this.right===t&&pn(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Wn(t.deleteSet,this.id.client,this.id.clock,this.length),Qi(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Zt();this.content.gc(t),n?ql(t,this,new te(this.id,this.length)):this.content=new wn(this.length)}write(t,n){const r=n>0?W(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&fr|(r===null?0:ne)|(s===null?0:Te)|(i===null?0:Bn);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const u=_s(c);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===gn?(t.writeParentInfo(!1),t.writeLeftID(c)):Zt();i!==null&&t.writeString(i)}this.content.write(t,n)}}const zo=(e,t)=>Fa[t&fr](e),Fa=[()=>{Zt()},Sa,Aa,va,La,Ca,Ea,Ba,Oa,ka,()=>{Zt()}],Va=10;class Yt extends Tr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Zt()}write(t,n){t.writeInfo(Va),U(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const qo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Po="__ $YJS$ __";qo[Po]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),qo[Po]=!0;const za=Object.freeze(Object.defineProperty({__proto__:null,AbsolutePosition:Hi,AbstractConnector:gl,AbstractStruct:Tr,AbstractType:xt,Array:Ue,ContentAny:Fe,ContentBinary:mn,ContentDeleted:wn,ContentDoc:bn,ContentEmbed:Be,ContentFormat:Et,ContentJSON:In,ContentString:ue,ContentType:he,Doc:Je,GC:te,ID:gn,Item:ct,Map:Ze,PermanentUserData:Al,RelativePosition:Sr,Skip:Yt,Snapshot:Ss,Text:_n,Transaction:Xi,UndoManager:$l,UpdateDecoderV1:le,UpdateDecoderV2:re,UpdateEncoderV1:Ye,UpdateEncoderV2:ge,XmlElement:nn,XmlFragment:en,XmlHook:xn,XmlText:er,YArrayEvent:Ao,YEvent:Qn,YMapEvent:Do,YTextEvent:No,YXmlEvent:Uo,applyUpdate:Mi,applyUpdateV2:vr,cleanupYTextFormatting:Ro,compareIDs:pn,compareRelativePositions:vs,convertUpdateFormatV1ToV2:ea,convertUpdateFormatV2ToV1:ho,createAbsolutePositionFromRelativePosition:bs,createDeleteSet:wr,createDeleteSetFromStructStore:fs,createDocFromSnapshot:Fl,createID:W,createRelativePositionFromJSON:ms,createRelativePositionFromTypeIndex:ws,createSnapshot:ks,decodeRelativePosition:Tl,decodeSnapshot:Nl,decodeSnapshotV2:Gi,decodeStateVector:ps,decodeUpdate:Jl,decodeUpdateV2:io,diffUpdate:Ql,diffUpdateV2:Os,emptySnapshot:Ul,encodeRelativePosition:xl,encodeSnapshot:jl,encodeSnapshotV2:$i,encodeStateAsUpdate:ji,encodeStateAsUpdateV2:Ri,encodeStateVector:Ui,encodeStateVectorFromUpdate:Yl,encodeStateVectorFromUpdateV2:co,equalDeleteSets:xi,equalSnapshots:Rl,findIndexSS:ae,findRootTypeKey:_s,getItem:yn,getItemCleanEnd:As,getItemCleanStart:$t,getState:_t,getTypeChildren:oa,isDeleted:fn,isParentOf:Yn,iterateDeletedStructs:hn,logType:El,logUpdate:Wl,logUpdateV2:so,mergeDeleteSets:dn,mergeUpdates:oo,mergeUpdatesV2:Kn,obfuscateUpdate:Zl,obfuscateUpdateV2:ta,parseUpdateMeta:Xl,parseUpdateMetaV2:lo,readUpdate:bl,readUpdateV2:gs,relativePositionToJSON:Dl,snapshot:Bl,snapshotContainsUpdate:zl,transact:lt,tryGc:Pl,typeListToArraySnapshot:ca,typeMapGetAllSnapshot:Eo,typeMapGetSnapshot:ua},Symbol.toStringTag,{value:"Module"})),Bs=3e4;class qa extends cc{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=Ge();this.getLocalState()!==null&&Bs/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((s,i)=>{i!==this.clientID&&Bs<=n-s.lastUpdated&&this.states.has(i)&&r.push(i)}),r.length>0&&Fs(this,r,"timeout")},Ie(Bs/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,i=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:Ge()});const o=[],c=[],l=[],u=[];t===null?u.push(n):i==null?t!=null&&o.push(n):(c.push(n),Gn(i,t)||l.push(n)),(o.length>0||l.length>0||u.length>0)&&this.emit("change",[{added:o,updated:l,removed:u},"local"]),this.emit("update",[{added:o,updated:c,removed:u},"local"])}setLocalStateField(t,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[t]:n})}getStates(){return this.states}}const Fs=(e,t,n)=>{const r=[];for(let s=0;s<t.length;s++){const i=t[s];if(e.states.has(i)){if(e.states.delete(i),i===e.clientID){const o=e.meta.get(i);e.meta.set(i,{clock:o.clock+1,lastUpdated:Ge()})}r.push(i)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},nr=(e,t,n=e.states)=>{const r=t.length,s=Rt();U(s,r);for(let i=0;i<r;i++){const o=t[i],c=n.get(o)||null,l=e.meta.get(o).clock;U(s,o),U(s,l),He(s,JSON.stringify(c))}return ft(s)},Pa=(e,t,n)=>{const r=Nt(t),s=Ge(),i=[],o=[],c=[],l=[],u=$(r);for(let a=0;a<u;a++){const h=$(r);let d=$(r);const g=JSON.parse(Me(r)),y=e.meta.get(h),E=e.states.get(h),D=y===void 0?0:y.clock;(D<d||D===d&&g===null&&e.states.has(h))&&(g===null?h===e.clientID&&e.getLocalState()!=null?d++:e.states.delete(h):e.states.set(h,g),e.meta.set(h,{clock:d,lastUpdated:s}),y===void 0&&g!==null?i.push(h):y!==void 0&&g===null?l.push(h):g!==null&&(Gn(g,E)||c.push(h),o.push(h)))}(i.length>0||c.length>0||l.length>0)&&e.emit("change",[{added:i,updated:c,removed:l},n]),(i.length>0||o.length>0||l.length>0)&&e.emit("update",[{added:i,updated:o,removed:l},n])},Rr=(e,t,n,r,s)=>{try{if(t&&t.cursor&&n!==r.clientID){const i=t.user||{},o=i.color||"#ffa500",c=i.name||`User: ${n}`;e.createCursor(n.toString(),c,o);const l=bs(ms(t.cursor.anchor),r),u=bs(ms(t.cursor.head),r);l&&u&&l.type===s&&e.moveCursor(n.toString(),{index:l.index,length:u.index-l.index})}else e.removeCursor(n.toString())}catch(i){console.error(i)}};class Ha{constructor(t,n,r){const s=t.doc;this.type=t,this.doc=s,this.quill=n;const i=n.getModule("cursors")||null;this.quillCursors=i,this._negatedUsedFormats={},this.awareness=r,this._awarenessChange=({added:o,removed:c,updated:l})=>{const u=r.getStates();o.forEach(a=>{Rr(i,u.get(a),a,s,t)}),l.forEach(a=>{Rr(i,u.get(a),a,s,t)}),c.forEach(a=>{i.removeCursor(a.toString())})},this._typeObserver=o=>{if(o.transaction.origin!==this){const c=o.delta,l=[];for(let u=0;u<c.length;u++){const a=c[u];a.insert!==void 0?l.push(Object.assign({},a,{attributes:Object.assign({},this._negatedUsedFormats,a.attributes||{})})):l.push(a)}n.updateContents(l,this)}},t.observe(this._typeObserver),this._quillObserver=(o,c,l,u)=>{if(c&&c.ops){const a=c.ops;a.forEach(h=>{if(h.attributes!==void 0)for(let d in h.attributes)this._negatedUsedFormats[d]===void 0&&(this._negatedUsedFormats[d]=!1)}),u!==this&&s.transact(()=>{t.applyDelta(a)},this)}if(r&&i){const a=n.getSelection(),h=r.getLocalState();if(a===null)r.getLocalState()!==null&&r.setLocalStateField("cursor",null);else{const d=ws(t,a.index),g=ws(t,a.index+a.length);(!h||!h.cursor||!vs(d,h.cursor.anchor)||!vs(g,h.cursor.head))&&r.setLocalStateField("cursor",{anchor:d,head:g})}r.getStates().forEach((d,g)=>{Rr(i,d,g,s,t)})}},n.on("editor-change",this._quillObserver),n.setContents(t.toDelta(),this),i!==null&&r&&(r.getStates().forEach((o,c)=>{Rr(i,o,c,s,t)}),r.on("change",this._awarenessChange))}destroy(){this.type.unobserve(this._typeObserver),this.quill.off("editor-change",this._quillObserver),this.awareness&&this.awareness.off("change",this._awarenessChange)}}function $a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ho={exports:{}};/*! For license information please see quill-cursors.js.LICENSE.txt */(function(e,t){(function(n,r){e.exports=r()})(self,()=>(()=>{var n={582:(o,c,l)=>{l.d(c,{Z:()=>g});var u=l(81),a=l.n(u),h=l(645),d=l.n(h)()(a());d.push([o.id,".ql-container{position:relative;overflow:hidden}@media(pointer: coarse){.ql-cursor-caret-container{z-index:-1}}.ql-cursor.hidden{display:none}.ql-cursor .ql-cursor-caret-container,.ql-cursor .ql-cursor-flag{position:absolute}.ql-cursor .ql-cursor-flag{z-index:1;transform:translate3d(-1px, -100%, 0);opacity:0;visibility:hidden;color:#fff;padding-bottom:2px;border-radius:0 3px 3px 0}.ql-cursor .ql-cursor-flag.flag-flipped{border-radius:3px 0 0 3px;transform:translate3d(calc(-100% + 1px ), -100%, 0)}@media screen{.ql-cursor .ql-cursor-flag{transition:opacity 0ms cubic-bezier(0.25, 0.46, 0.45, 0.94) 0ms,visibility 0ms cubic-bezier(0.25, 0.46, 0.45, 0.94) 0ms}}.ql-cursor .ql-cursor-flag .ql-cursor-name{margin-left:5px;margin-right:5px;display:inline-block;margin-top:-2px;white-space:nowrap}.ql-cursor .ql-cursor-flag.no-delay[style]{transition-delay:unset !important}.ql-cursor .ql-cursor-caret-container{cursor:text;margin-left:-9px;padding:0 9px}.ql-cursor .ql-cursor-caret-container.hover+.ql-cursor-flag{opacity:1;visibility:visible;transition:none}.ql-cursor .ql-cursor-caret-container.no-pointer{pointer-events:none}.ql-cursor .ql-cursor-caret-container .ql-cursor-caret{position:absolute;top:0;bottom:0;width:2px;margin-left:-1px;background-color:attr(data-color)}.ql-cursor .ql-cursor-selection-block{position:absolute;pointer-events:none}",""]);const g=d},645:o=>{o.exports=function(c){var l=[];return l.toString=function(){return this.map(function(u){var a="",h=u[5]!==void 0;return u[4]&&(a+="@supports (".concat(u[4],") {")),u[2]&&(a+="@media ".concat(u[2]," {")),h&&(a+="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {")),a+=c(u),h&&(a+="}"),u[2]&&(a+="}"),u[4]&&(a+="}"),a}).join("")},l.i=function(u,a,h,d,g){typeof u=="string"&&(u=[[null,u,void 0]]);var y={};if(h)for(var E=0;E<this.length;E++){var D=this[E][0];D!=null&&(y[D]=!0)}for(var S=0;S<u.length;S++){var _=[].concat(u[S]);h&&y[_[0]]||(g!==void 0&&(_[5]===void 0||(_[1]="@layer".concat(_[5].length>0?" ".concat(_[5]):""," {").concat(_[1],"}")),_[5]=g),a&&(_[2]&&(_[1]="@media ".concat(_[2]," {").concat(_[1],"}")),_[2]=a),d&&(_[4]?(_[1]="@supports (".concat(_[4],") {").concat(_[1],"}"),_[4]=d):_[4]="".concat(d)),l.push(_))}},l}},81:o=>{o.exports=function(c){return c[1]}},529:o=>{var c=-1;function l(f,p,b,w){if(f===p)return f?[[0,f]]:[];if(b!=null){var A=function(G,R,L){var O=typeof L=="number"?{index:L,length:0}:L.oldRange,x=typeof L=="number"?null:L.newRange,F=G.length,V=R.length;if(O.length===0&&(x===null||x.length===0)){var rt=O.index,dt=G.slice(0,rt),vt=G.slice(rt),pt=x?x.index:null,P=rt+V-F;if((pt===null||pt===P)&&!(P<0||P>V)){var se=R.slice(0,P);if((at=R.slice(P))===vt){var Vt=Math.min(rt,P);if((yt=dt.slice(0,Vt))===(ot=se.slice(0,Vt)))return S(yt,dt.slice(Vt),se.slice(Vt),vt)}}if(pt===null||pt===rt){var Z=rt,at=(se=R.slice(0,Z),R.slice(Z));if(se===dt){var tt=Math.min(F-Z,V-Z);if((It=vt.slice(vt.length-tt))===(Tt=at.slice(at.length-tt)))return S(dt,vt.slice(0,vt.length-tt),at.slice(0,at.length-tt),It)}}}if(O.length>0&&x&&x.length===0){var yt=G.slice(0,O.index),It=G.slice(O.index+O.length);if(!(V<(Vt=yt.length)+(tt=It.length))){var ot=R.slice(0,Vt),Tt=R.slice(V-tt);if(yt===ot&&It===Tt)return S(yt,G.slice(Vt,F-tt),R.slice(Vt,V-tt),It)}}return null}(f,p,b);if(A)return A}var M=a(f,p),j=f.substring(0,M);M=h(f=f.substring(M),p=p.substring(M));var B=f.substring(f.length-M),q=function(G,R){var L;if(!G)return[[1,R]];if(!R)return[[c,G]];var O=G.length>R.length?G:R,x=G.length>R.length?R:G,F=O.indexOf(x);if(F!==-1)return L=[[1,O.substring(0,F)],[0,x],[1,O.substring(F+x.length)]],G.length>R.length&&(L[0][0]=L[2][0]=c),L;if(x.length===1)return[[c,G],[1,R]];var V=function(Z,at){var tt=Z.length>at.length?Z:at,yt=Z.length>at.length?at:Z;if(tt.length<4||2*yt.length<tt.length)return null;function It(Qt,zt,qt){for(var de,Ut,At,gt,Gt=Qt.substring(qt,qt+Math.floor(Qt.length/4)),St=-1,Dt="";(St=zt.indexOf(Gt,St+1))!==-1;){var mt=a(Qt.substring(qt),zt.substring(St)),Wt=h(Qt.substring(0,qt),zt.substring(0,St));Dt.length<Wt+mt&&(Dt=zt.substring(St-Wt,St)+zt.substring(St,St+mt),de=Qt.substring(0,qt-Wt),Ut=Qt.substring(qt+mt),At=zt.substring(0,St-Wt),gt=zt.substring(St+mt))}return 2*Dt.length>=Qt.length?[de,Ut,At,gt,Dt]:null}var ot,Tt,Mt,ut,Xt,Kt=It(tt,yt,Math.ceil(tt.length/4)),fe=It(tt,yt,Math.ceil(tt.length/2));return Kt||fe?(ot=fe?Kt&&Kt[4].length>fe[4].length?Kt:fe:Kt,Z.length>at.length?(Tt=ot[0],Mt=ot[1],ut=ot[2],Xt=ot[3]):(ut=ot[0],Xt=ot[1],Tt=ot[2],Mt=ot[3]),[Tt,Mt,ut,Xt,ot[4]]):null}(G,R);if(V){var rt=V[0],dt=V[1],vt=V[2],pt=V[3],P=V[4],se=l(rt,vt),Vt=l(dt,pt);return se.concat([[0,P]],Vt)}return function(Z,at){for(var tt=Z.length,yt=at.length,It=Math.ceil((tt+yt)/2),ot=It,Tt=2*It,Mt=new Array(Tt),ut=new Array(Tt),Xt=0;Xt<Tt;Xt++)Mt[Xt]=-1,ut[Xt]=-1;Mt[ot+1]=0,ut[ot+1]=0;for(var Kt=tt-yt,fe=Kt%2!=0,Qt=0,zt=0,qt=0,de=0,Ut=0;Ut<It;Ut++){for(var At=-Ut+Qt;At<=Ut-zt;At+=2){for(var gt=ot+At,Gt=(Pt=At===-Ut||At!==Ut&&Mt[gt-1]<Mt[gt+1]?Mt[gt+1]:Mt[gt-1]+1)-At;Pt<tt&&Gt<yt&&Z.charAt(Pt)===at.charAt(Gt);)Pt++,Gt++;if(Mt[gt]=Pt,Pt>tt)zt+=2;else if(Gt>yt)Qt+=2;else if(fe&&(mt=ot+Kt-At)>=0&&mt<Tt&&ut[mt]!==-1&&Pt>=(Dt=tt-ut[mt]))return u(Z,at,Pt,Gt)}for(var St=-Ut+qt;St<=Ut-de;St+=2){for(var Dt,mt=ot+St,Wt=(Dt=St===-Ut||St!==Ut&&ut[mt-1]<ut[mt+1]?ut[mt+1]:ut[mt-1]+1)-St;Dt<tt&&Wt<yt&&Z.charAt(tt-Dt-1)===at.charAt(yt-Wt-1);)Dt++,Wt++;if(ut[mt]=Dt,Dt>tt)de+=2;else if(Wt>yt)qt+=2;else if(!fe){var Pt;if((gt=ot+Kt-St)>=0&&gt<Tt&&Mt[gt]!==-1&&(Gt=ot+(Pt=Mt[gt])-gt,Pt>=(Dt=tt-Dt)))return u(Z,at,Pt,Gt)}}}return[[c,Z],[1,at]]}(G,R)}(f=f.substring(0,f.length-M),p=p.substring(0,p.length-M));return j&&q.unshift([0,j]),B&&q.push([0,B]),d(q,w),q}function u(f,p,b,w){var A=f.substring(0,b),M=p.substring(0,w),j=f.substring(b),B=p.substring(w),q=l(A,M),G=l(j,B);return q.concat(G)}function a(f,p){if(!f||!p||f.charAt(0)!==p.charAt(0))return 0;for(var b=0,w=Math.min(f.length,p.length),A=w,M=0;b<A;)f.substring(M,A)==p.substring(M,A)?M=b=A:w=A,A=Math.floor((w-b)/2+b);return g(f.charCodeAt(A-1))&&A--,A}function h(f,p){if(!f||!p||f.slice(-1)!==p.slice(-1))return 0;for(var b=0,w=Math.min(f.length,p.length),A=w,M=0;b<A;)f.substring(f.length-A,f.length-M)==p.substring(p.length-A,p.length-M)?M=b=A:w=A,A=Math.floor((w-b)/2+b);return y(f.charCodeAt(f.length-A))&&A--,A}function d(f,p){f.push([0,""]);for(var b,w=0,A=0,M=0,j="",B="";w<f.length;)if(w<f.length-1&&!f[w][1])f.splice(w,1);else switch(f[w][0]){case 1:M++,B+=f[w][1],w++;break;case c:A++,j+=f[w][1],w++;break;case 0:var q=w-M-A-1;if(p){if(q>=0&&D(f[q][1])){var G=f[q][1].slice(-1);if(f[q][1]=f[q][1].slice(0,-1),j=G+j,B=G+B,!f[q][1]){f.splice(q,1),w--;var R=q-1;f[R]&&f[R][0]===1&&(M++,B=f[R][1]+B,R--),f[R]&&f[R][0]===c&&(A++,j=f[R][1]+j,R--),q=R}}E(f[w][1])&&(G=f[w][1].charAt(0),f[w][1]=f[w][1].slice(1),j+=G,B+=G)}if(w<f.length-1&&!f[w][1]){f.splice(w,1);break}if(j.length>0||B.length>0){j.length>0&&B.length>0&&((b=a(B,j))!==0&&(q>=0?f[q][1]+=B.substring(0,b):(f.splice(0,0,[0,B.substring(0,b)]),w++),B=B.substring(b),j=j.substring(b)),(b=h(B,j))!==0&&(f[w][1]=B.substring(B.length-b)+f[w][1],B=B.substring(0,B.length-b),j=j.substring(0,j.length-b)));var L=M+A;j.length===0&&B.length===0?(f.splice(w-L,L),w-=L):j.length===0?(f.splice(w-L,L,[1,B]),w=w-L+1):B.length===0?(f.splice(w-L,L,[c,j]),w=w-L+1):(f.splice(w-L,L,[c,j],[1,B]),w=w-L+2)}w!==0&&f[w-1][0]===0?(f[w-1][1]+=f[w][1],f.splice(w,1)):w++,M=0,A=0,j="",B=""}f[f.length-1][1]===""&&f.pop();var O=!1;for(w=1;w<f.length-1;)f[w-1][0]===0&&f[w+1][0]===0&&(f[w][1].substring(f[w][1].length-f[w-1][1].length)===f[w-1][1]?(f[w][1]=f[w-1][1]+f[w][1].substring(0,f[w][1].length-f[w-1][1].length),f[w+1][1]=f[w-1][1]+f[w+1][1],f.splice(w-1,1),O=!0):f[w][1].substring(0,f[w+1][1].length)==f[w+1][1]&&(f[w-1][1]+=f[w+1][1],f[w][1]=f[w][1].substring(f[w+1][1].length)+f[w+1][1],f.splice(w+1,1),O=!0)),w++;O&&d(f,p)}function g(f){return f>=55296&&f<=56319}function y(f){return f>=56320&&f<=57343}function E(f){return y(f.charCodeAt(0))}function D(f){return g(f.charCodeAt(f.length-1))}function S(f,p,b,w){return D(f)||E(w)?null:function(A){for(var M=[],j=0;j<A.length;j++)A[j][1].length>0&&M.push(A[j]);return M}([[0,f],[c,p],[1,b],[0,w]])}function _(f,p,b){return l(f,p,b,!0)}_.INSERT=1,_.DELETE=c,_.EQUAL=0,o.exports=_},465:(o,c,l)=>{o=l.nmd(o);var u="__lodash_hash_undefined__",a=9007199254740991,h="[object Arguments]",d="[object Boolean]",g="[object Date]",y="[object Function]",E="[object GeneratorFunction]",D="[object Map]",S="[object Number]",_="[object Object]",f="[object Promise]",p="[object RegExp]",b="[object Set]",w="[object String]",A="[object Symbol]",M="[object WeakMap]",j="[object ArrayBuffer]",B="[object DataView]",q="[object Float32Array]",G="[object Float64Array]",R="[object Int8Array]",L="[object Int16Array]",O="[object Int32Array]",x="[object Uint8Array]",F="[object Uint8ClampedArray]",V="[object Uint16Array]",rt="[object Uint32Array]",dt=/\w*$/,vt=/^\[object .+?Constructor\]$/,pt=/^(?:0|[1-9]\d*)$/,P={};P[h]=P["[object Array]"]=P[j]=P[B]=P[d]=P[g]=P[q]=P[G]=P[R]=P[L]=P[O]=P[D]=P[S]=P[_]=P[p]=P[b]=P[w]=P[A]=P[x]=P[F]=P[V]=P[rt]=!0,P["[object Error]"]=P[y]=P[M]=!1;var se=typeof l.g=="object"&&l.g&&l.g.Object===Object&&l.g,Vt=typeof self=="object"&&self&&self.Object===Object&&self,Z=se||Vt||Function("return this")(),at=c&&!c.nodeType&&c,tt=at&&o&&!o.nodeType&&o,yt=tt&&tt.exports===at;function It(m,k){return m.set(k[0],k[1]),m}function ot(m,k){return m.add(k),m}function Tt(m,k,T,N){var J=-1,st=m?m.length:0;for(N&&st&&(T=m[++J]);++J<st;)T=k(T,m[J],J,m);return T}function Mt(m){var k=!1;if(m!=null&&typeof m.toString!="function")try{k=!!(m+"")}catch{}return k}function ut(m){var k=-1,T=Array(m.size);return m.forEach(function(N,J){T[++k]=[J,N]}),T}function Xt(m,k){return function(T){return m(k(T))}}function Kt(m){var k=-1,T=Array(m.size);return m.forEach(function(N){T[++k]=N}),T}var fe,Qt=Array.prototype,zt=Function.prototype,qt=Object.prototype,de=Z["__core-js_shared__"],Ut=(fe=/[^.]+$/.exec(de&&de.keys&&de.keys.IE_PROTO||""))?"Symbol(src)_1."+fe:"",At=zt.toString,gt=qt.hasOwnProperty,Gt=qt.toString,St=RegExp("^"+At.call(gt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Dt=yt?Z.Buffer:void 0,mt=Z.Symbol,Wt=Z.Uint8Array,Pt=Xt(Object.getPrototypeOf,Object),sr=Object.create,Sn=qt.propertyIsEnumerable,$s=Qt.splice,jr=Object.getOwnPropertySymbols,Gs=Dt?Dt.isBuffer:void 0,Ws=Xt(Object.keys,Object),ir=Ee(Z,"DataView"),rn=Ee(Z,"Map"),kn=Ee(Z,"Promise"),pe=Ee(Z,"Set"),ie=Ee(Z,"WeakMap"),oe=Ee(Object,"create"),Rn=De(ir),ke=De(rn),jn=De(kn),Cn=De(pe),Nr=De(ie),or=mt?mt.prototype:void 0,cr=or?or.valueOf:void 0;function Ce(m){var k=-1,T=m?m.length:0;for(this.clear();++k<T;){var N=m[k];this.set(N[0],N[1])}}function ee(m){var k=-1,T=m?m.length:0;for(this.clear();++k<T;){var N=m[k];this.set(N[0],N[1])}}function ce(m){var k=-1,T=m?m.length:0;for(this.clear();++k<T;){var N=m[k];this.set(N[0],N[1])}}function sn(m){this.__data__=new ee(m)}function ye(m,k,T){var N=m[k];gt.call(m,k)&&Fr(N,T)&&(T!==void 0||k in m)||(m[k]=T)}function Nn(m,k){for(var T=m.length;T--;)if(Fr(m[T][0],k))return T;return-1}function _e(m,k,T,N,J,st,ht){var K;if(N&&(K=st?N(m,J,st,ht):N(m)),K!==void 0)return K;if(!nt(m))return m;var Ot=v(m);if(Ot){if(K=function(H){var it=H.length,Lt=H.constructor(it);return it&&typeof H[0]=="string"&&gt.call(H,"index")&&(Lt.index=H.index,Lt.input=H.input),Lt}(m),!k)return function(H,it){var Lt=-1,X=H.length;for(it||(it=Array(X));++Lt<X;)it[Lt]=H[Lt];return it}(m,K)}else{var wt=Ae(m),Oe=wt==y||wt==E;if(I(m))return function(H,it){if(it)return H.slice();var Lt=new H.constructor(H.length);return H.copy(Lt),Lt}(m,k);if(wt==_||wt==h||Oe&&!st){if(Mt(m))return st?m:{};if(K=function(H){return typeof H.constructor!="function"||on(H)?{}:nt(it=Pt(H))?sr(it):{};var it}(Oe?{}:m),!k)return function(H,it){return Ur(H,lr(H),it)}(m,function(H,it){return H&&Ur(it,Y(it),H)}(K,m))}else{if(!P[wt])return st?m:{};K=function(H,it,Lt,X){var et,me=H.constructor;switch(it){case j:return Un(H);case d:case g:return new me(+H);case B:return function(Q,Bt){var kt=Bt?Un(Q.buffer):Q.buffer;return new Q.constructor(kt,Q.byteOffset,Q.byteLength)}(H,X);case q:case G:case R:case L:case O:case x:case F:case V:case rt:return function(Q,Bt){var kt=Bt?Un(Q.buffer):Q.buffer;return new Q.constructor(kt,Q.byteOffset,Q.length)}(H,X);case D:return function(Q,Bt,kt){return Tt(Bt?kt(ut(Q),!0):ut(Q),It,new Q.constructor)}(H,X,Lt);case S:case w:return new me(H);case p:return function(Q){var Bt=new Q.constructor(Q.source,dt.exec(Q));return Bt.lastIndex=Q.lastIndex,Bt}(H);case b:return function(Q,Bt,kt){return Tt(Bt?kt(Kt(Q),!0):Kt(Q),ot,new Q.constructor)}(H,X,Lt);case A:return et=H,cr?Object(cr.call(et)):{}}}(m,wt,_e,k)}}ht||(ht=new sn);var ze=ht.get(m);if(ze)return ze;if(ht.set(m,K),!Ot)var cn=T?function(H){return function(it,Lt,X){var et=Lt(it);return v(it)?et:function(me,Q){for(var Bt=-1,kt=Q.length,we=me.length;++Bt<kt;)me[we+Bt]=Q[Bt];return me}(et,X(it))}(H,Y,lr)}(m):Y(m);return function(H,it){for(var Lt=-1,X=H?H.length:0;++Lt<X&&it(H[Lt],Lt)!==!1;);}(cn||m,function(H,it){cn&&(H=m[it=H]),ye(K,it,_e(H,k,T,N,it,m,ht))}),K}function Un(m){var k=new m.constructor(m.byteLength);return new Wt(k).set(new Wt(m)),k}function Ur(m,k,T,N){T||(T={});for(var J=-1,st=k.length;++J<st;){var ht=k[J],K=N?N(T[ht],m[ht],ht,T,m):void 0;ye(T,ht,K===void 0?m[ht]:K)}return T}function Ve(m,k){var T,N,J=m.__data__;return((N=typeof(T=k))=="string"||N=="number"||N=="symbol"||N=="boolean"?T!=="__proto__":T===null)?J[typeof k=="string"?"string":"hash"]:J.map}function Ee(m,k){var T=function(N,J){return N==null?void 0:N[J]}(m,k);return function(N){return!(!nt(N)||(J=N,Ut&&Ut in J))&&(z(N)||Mt(N)?St:vt).test(De(N));var J}(T)?T:void 0}Ce.prototype.clear=function(){this.__data__=oe?oe(null):{}},Ce.prototype.delete=function(m){return this.has(m)&&delete this.__data__[m]},Ce.prototype.get=function(m){var k=this.__data__;if(oe){var T=k[m];return T===u?void 0:T}return gt.call(k,m)?k[m]:void 0},Ce.prototype.has=function(m){var k=this.__data__;return oe?k[m]!==void 0:gt.call(k,m)},Ce.prototype.set=function(m,k){return this.__data__[m]=oe&&k===void 0?u:k,this},ee.prototype.clear=function(){this.__data__=[]},ee.prototype.delete=function(m){var k=this.__data__,T=Nn(k,m);return!(T<0||(T==k.length-1?k.pop():$s.call(k,T,1),0))},ee.prototype.get=function(m){var k=this.__data__,T=Nn(k,m);return T<0?void 0:k[T][1]},ee.prototype.has=function(m){return Nn(this.__data__,m)>-1},ee.prototype.set=function(m,k){var T=this.__data__,N=Nn(T,m);return N<0?T.push([m,k]):T[N][1]=k,this},ce.prototype.clear=function(){this.__data__={hash:new Ce,map:new(rn||ee),string:new Ce}},ce.prototype.delete=function(m){return Ve(this,m).delete(m)},ce.prototype.get=function(m){return Ve(this,m).get(m)},ce.prototype.has=function(m){return Ve(this,m).has(m)},ce.prototype.set=function(m,k){return Ve(this,m).set(m,k),this},sn.prototype.clear=function(){this.__data__=new ee},sn.prototype.delete=function(m){return this.__data__.delete(m)},sn.prototype.get=function(m){return this.__data__.get(m)},sn.prototype.has=function(m){return this.__data__.has(m)},sn.prototype.set=function(m,k){var T=this.__data__;if(T instanceof ee){var N=T.__data__;if(!rn||N.length<199)return N.push([m,k]),this;T=this.__data__=new ce(N)}return T.set(m,k),this};var lr=jr?Xt(jr,Object):function(){return[]},Ae=function(m){return Gt.call(m)};function Br(m,k){return!!(k=k??a)&&(typeof m=="number"||pt.test(m))&&m>-1&&m%1==0&&m<k}function on(m){var k=m&&m.constructor;return m===(typeof k=="function"&&k.prototype||qt)}function De(m){if(m!=null){try{return At.call(m)}catch{}try{return m+""}catch{}}return""}function Fr(m,k){return m===k||m!=m&&k!=k}(ir&&Ae(new ir(new ArrayBuffer(1)))!=B||rn&&Ae(new rn)!=D||kn&&Ae(kn.resolve())!=f||pe&&Ae(new pe)!=b||ie&&Ae(new ie)!=M)&&(Ae=function(m){var k=Gt.call(m),T=k==_?m.constructor:void 0,N=T?De(T):void 0;if(N)switch(N){case Rn:return B;case ke:return D;case jn:return f;case Cn:return b;case Nr:return M}return k});var v=Array.isArray;function C(m){return m!=null&&function(k){return typeof k=="number"&&k>-1&&k%1==0&&k<=a}(m.length)&&!z(m)}var I=Gs||function(){return!1};function z(m){var k=nt(m)?Gt.call(m):"";return k==y||k==E}function nt(m){var k=typeof m;return!!m&&(k=="object"||k=="function")}function Y(m){return C(m)?function(k,T){var N=v(k)||function(K){return function(Ot){return function(wt){return!!wt&&typeof wt=="object"}(Ot)&&C(Ot)}(K)&&gt.call(K,"callee")&&(!Sn.call(K,"callee")||Gt.call(K)==h)}(k)?function(K,Ot){for(var wt=-1,Oe=Array(K);++wt<K;)Oe[wt]=Ot(wt);return Oe}(k.length,String):[],J=N.length,st=!!J;for(var ht in k)!T&&!gt.call(k,ht)||st&&(ht=="length"||Br(ht,J))||N.push(ht);return N}(m):function(k){if(!on(k))return Ws(k);var T=[];for(var N in Object(k))gt.call(k,N)&&N!="constructor"&&T.push(N);return T}(m)}o.exports=function(m){return _e(m,!0,!0)}},307:(o,c,l)=>{o=l.nmd(o);var u="__lodash_hash_undefined__",a=9007199254740991,h="[object Arguments]",d="[object Array]",g="[object Boolean]",y="[object Date]",E="[object Error]",D="[object Function]",S="[object Map]",_="[object Number]",f="[object Object]",p="[object Promise]",b="[object RegExp]",w="[object Set]",A="[object String]",M="[object WeakMap]",j="[object ArrayBuffer]",B="[object DataView]",q=/^\[object .+?Constructor\]$/,G=/^(?:0|[1-9]\d*)$/,R={};R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R[h]=R[d]=R[j]=R[g]=R[B]=R[y]=R[E]=R[D]=R[S]=R[_]=R[f]=R[b]=R[w]=R[A]=R[M]=!1;var L=typeof l.g=="object"&&l.g&&l.g.Object===Object&&l.g,O=typeof self=="object"&&self&&self.Object===Object&&self,x=L||O||Function("return this")(),F=c&&!c.nodeType&&c,V=F&&o&&!o.nodeType&&o,rt=V&&V.exports===F,dt=rt&&L.process,vt=function(){try{return dt&&dt.binding&&dt.binding("util")}catch{}}(),pt=vt&&vt.isTypedArray;function P(v,C){for(var I=-1,z=v==null?0:v.length;++I<z;)if(C(v[I],I,v))return!0;return!1}function se(v){var C=-1,I=Array(v.size);return v.forEach(function(z,nt){I[++C]=[nt,z]}),I}function Vt(v){var C=-1,I=Array(v.size);return v.forEach(function(z){I[++C]=z}),I}var Z,at,tt,yt=Array.prototype,It=Function.prototype,ot=Object.prototype,Tt=x["__core-js_shared__"],Mt=It.toString,ut=ot.hasOwnProperty,Xt=(Z=/[^.]+$/.exec(Tt&&Tt.keys&&Tt.keys.IE_PROTO||""))?"Symbol(src)_1."+Z:"",Kt=ot.toString,fe=RegExp("^"+Mt.call(ut).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qt=rt?x.Buffer:void 0,zt=x.Symbol,qt=x.Uint8Array,de=ot.propertyIsEnumerable,Ut=yt.splice,At=zt?zt.toStringTag:void 0,gt=Object.getOwnPropertySymbols,Gt=Qt?Qt.isBuffer:void 0,St=(at=Object.keys,tt=Object,function(v){return at(tt(v))}),Dt=ce(x,"DataView"),mt=ce(x,"Map"),Wt=ce(x,"Promise"),Pt=ce(x,"Set"),sr=ce(x,"WeakMap"),Sn=ce(Object,"create"),$s=_e(Dt),jr=_e(mt),Gs=_e(Wt),Ws=_e(Pt),ir=_e(sr),rn=zt?zt.prototype:void 0,kn=rn?rn.valueOf:void 0;function pe(v){var C=-1,I=v==null?0:v.length;for(this.clear();++C<I;){var z=v[C];this.set(z[0],z[1])}}function ie(v){var C=-1,I=v==null?0:v.length;for(this.clear();++C<I;){var z=v[C];this.set(z[0],z[1])}}function oe(v){var C=-1,I=v==null?0:v.length;for(this.clear();++C<I;){var z=v[C];this.set(z[0],z[1])}}function Rn(v){var C=-1,I=v==null?0:v.length;for(this.__data__=new oe;++C<I;)this.add(v[C])}function ke(v){var C=this.__data__=new ie(v);this.size=C.size}function jn(v,C){for(var I=v.length;I--;)if(Un(v[I][0],C))return I;return-1}function Cn(v){return v==null?v===void 0?"[object Undefined]":"[object Null]":At&&At in Object(v)?function(C){var I=ut.call(C,At),z=C[At];try{C[At]=void 0;var nt=!0}catch{}var Y=Kt.call(C);return nt&&(I?C[At]=z:delete C[At]),Y}(v):function(C){return Kt.call(C)}(v)}function Nr(v){return on(v)&&Cn(v)==h}function or(v,C,I,z,nt){return v===C||(v==null||C==null||!on(v)&&!on(C)?v!=v&&C!=C:function(Y,m,k,T,N,J){var st=Ve(Y),ht=Ve(m),K=st?d:ye(Y),Ot=ht?d:ye(m),wt=(K=K==h?f:K)==f,Oe=(Ot=Ot==h?f:Ot)==f,ze=K==Ot;if(ze&&Ee(Y)){if(!Ee(m))return!1;st=!0,wt=!1}if(ze&&!wt)return J||(J=new ke),st||De(Y)?cr(Y,m,k,T,N,J):function(X,et,me,Q,Bt,kt,we){switch(me){case B:if(X.byteLength!=et.byteLength||X.byteOffset!=et.byteOffset)return!1;X=X.buffer,et=et.buffer;case j:return!(X.byteLength!=et.byteLength||!kt(new qt(X),new qt(et)));case g:case y:case _:return Un(+X,+et);case E:return X.name==et.name&&X.message==et.message;case b:case A:return X==et+"";case S:var ln=se;case w:var ar=1&Q;if(ln||(ln=Vt),X.size!=et.size&&!ar)return!1;var En=we.get(X);if(En)return En==et;Q|=2,we.set(X,et);var qe=cr(ln(X),ln(et),Q,Bt,kt,we);return we.delete(X),qe;case"[object Symbol]":if(kn)return kn.call(X)==kn.call(et)}return!1}(Y,m,K,k,T,N,J);if(!(1&k)){var cn=wt&&ut.call(Y,"__wrapped__"),H=Oe&&ut.call(m,"__wrapped__");if(cn||H){var it=cn?Y.value():Y,Lt=H?m.value():m;return J||(J=new ke),N(it,Lt,k,T,J)}}return!!ze&&(J||(J=new ke),function(X,et,me,Q,Bt,kt){var we=1&me,ln=Ce(X),ar=ln.length;if(ar!=Ce(et).length&&!we)return!1;for(var En=ar;En--;){var qe=ln[En];if(!(we?qe in et:ut.call(et,qe)))return!1}var tc=kt.get(X);if(tc&&kt.get(et))return tc==et;var Vr=!0;kt.set(X,et),kt.set(et,X);for(var Js=we;++En<ar;){var zr=X[qe=ln[En]],qr=et[qe];if(Q)var ec=we?Q(qr,zr,qe,et,X,kt):Q(zr,qr,qe,X,et,kt);if(!(ec===void 0?zr===qr||Bt(zr,qr,me,Q,kt):ec)){Vr=!1;break}Js||(Js=qe=="constructor")}if(Vr&&!Js){var Pr=X.constructor,Hr=et.constructor;Pr==Hr||!("constructor"in X)||!("constructor"in et)||typeof Pr=="function"&&Pr instanceof Pr&&typeof Hr=="function"&&Hr instanceof Hr||(Vr=!1)}return kt.delete(X),kt.delete(et),Vr}(Y,m,k,T,N,J))}(v,C,I,z,or,nt))}function cr(v,C,I,z,nt,Y){var m=1&I,k=v.length,T=C.length;if(k!=T&&!(m&&T>k))return!1;var N=Y.get(v);if(N&&Y.get(C))return N==C;var J=-1,st=!0,ht=2&I?new Rn:void 0;for(Y.set(v,C),Y.set(C,v);++J<k;){var K=v[J],Ot=C[J];if(z)var wt=m?z(Ot,K,J,C,v,Y):z(K,Ot,J,v,C,Y);if(wt!==void 0){if(wt)continue;st=!1;break}if(ht){if(!P(C,function(Oe,ze){if(cn=ze,!ht.has(cn)&&(K===Oe||nt(K,Oe,I,z,Y)))return ht.push(ze);var cn})){st=!1;break}}else if(K!==Ot&&!nt(K,Ot,I,z,Y)){st=!1;break}}return Y.delete(v),Y.delete(C),st}function Ce(v){return function(C,I,z){var nt=I(C);return Ve(C)?nt:function(Y,m){for(var k=-1,T=m.length,N=Y.length;++k<T;)Y[N+k]=m[k];return Y}(nt,z(C))}(v,Fr,sn)}function ee(v,C){var I,z,nt=v.__data__;return((z=typeof(I=C))=="string"||z=="number"||z=="symbol"||z=="boolean"?I!=="__proto__":I===null)?nt[typeof C=="string"?"string":"hash"]:nt.map}function ce(v,C){var I=function(z,nt){return z==null?void 0:z[nt]}(v,C);return function(z){return!(!Br(z)||function(nt){return!!Xt&&Xt in nt}(z))&&(lr(z)?fe:q).test(_e(z))}(I)?I:void 0}pe.prototype.clear=function(){this.__data__=Sn?Sn(null):{},this.size=0},pe.prototype.delete=function(v){var C=this.has(v)&&delete this.__data__[v];return this.size-=C?1:0,C},pe.prototype.get=function(v){var C=this.__data__;if(Sn){var I=C[v];return I===u?void 0:I}return ut.call(C,v)?C[v]:void 0},pe.prototype.has=function(v){var C=this.__data__;return Sn?C[v]!==void 0:ut.call(C,v)},pe.prototype.set=function(v,C){var I=this.__data__;return this.size+=this.has(v)?0:1,I[v]=Sn&&C===void 0?u:C,this},ie.prototype.clear=function(){this.__data__=[],this.size=0},ie.prototype.delete=function(v){var C=this.__data__,I=jn(C,v);return!(I<0||(I==C.length-1?C.pop():Ut.call(C,I,1),--this.size,0))},ie.prototype.get=function(v){var C=this.__data__,I=jn(C,v);return I<0?void 0:C[I][1]},ie.prototype.has=function(v){return jn(this.__data__,v)>-1},ie.prototype.set=function(v,C){var I=this.__data__,z=jn(I,v);return z<0?(++this.size,I.push([v,C])):I[z][1]=C,this},oe.prototype.clear=function(){this.size=0,this.__data__={hash:new pe,map:new(mt||ie),string:new pe}},oe.prototype.delete=function(v){var C=ee(this,v).delete(v);return this.size-=C?1:0,C},oe.prototype.get=function(v){return ee(this,v).get(v)},oe.prototype.has=function(v){return ee(this,v).has(v)},oe.prototype.set=function(v,C){var I=ee(this,v),z=I.size;return I.set(v,C),this.size+=I.size==z?0:1,this},Rn.prototype.add=Rn.prototype.push=function(v){return this.__data__.set(v,u),this},Rn.prototype.has=function(v){return this.__data__.has(v)},ke.prototype.clear=function(){this.__data__=new ie,this.size=0},ke.prototype.delete=function(v){var C=this.__data__,I=C.delete(v);return this.size=C.size,I},ke.prototype.get=function(v){return this.__data__.get(v)},ke.prototype.has=function(v){return this.__data__.has(v)},ke.prototype.set=function(v,C){var I=this.__data__;if(I instanceof ie){var z=I.__data__;if(!mt||z.length<199)return z.push([v,C]),this.size=++I.size,this;I=this.__data__=new oe(z)}return I.set(v,C),this.size=I.size,this};var sn=gt?function(v){return v==null?[]:(v=Object(v),function(C,I){for(var z=-1,nt=C==null?0:C.length,Y=0,m=[];++z<nt;){var k=C[z];T=k,de.call(v,T)&&(m[Y++]=k)}var T;return m}(gt(v)))}:function(){return[]},ye=Cn;function Nn(v,C){return!!(C=C??a)&&(typeof v=="number"||G.test(v))&&v>-1&&v%1==0&&v<C}function _e(v){if(v!=null){try{return Mt.call(v)}catch{}try{return v+""}catch{}}return""}function Un(v,C){return v===C||v!=v&&C!=C}(Dt&&ye(new Dt(new ArrayBuffer(1)))!=B||mt&&ye(new mt)!=S||Wt&&ye(Wt.resolve())!=p||Pt&&ye(new Pt)!=w||sr&&ye(new sr)!=M)&&(ye=function(v){var C=Cn(v),I=C==f?v.constructor:void 0,z=I?_e(I):"";if(z)switch(z){case $s:return B;case jr:return S;case Gs:return p;case Ws:return w;case ir:return M}return C});var Ur=Nr(function(){return arguments}())?Nr:function(v){return on(v)&&ut.call(v,"callee")&&!de.call(v,"callee")},Ve=Array.isArray,Ee=Gt||function(){return!1};function lr(v){if(!Br(v))return!1;var C=Cn(v);return C==D||C=="[object GeneratorFunction]"||C=="[object AsyncFunction]"||C=="[object Proxy]"}function Ae(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=a}function Br(v){var C=typeof v;return v!=null&&(C=="object"||C=="function")}function on(v){return v!=null&&typeof v=="object"}var De=pt?function(v){return function(C){return v(C)}}(pt):function(v){return on(v)&&Ae(v.length)&&!!R[Cn(v)]};function Fr(v){return(C=v)!=null&&Ae(C.length)&&!lr(C)?function(I,z){var nt=Ve(I),Y=!nt&&Ur(I),m=!nt&&!Y&&Ee(I),k=!nt&&!Y&&!m&&De(I),T=nt||Y||m||k,N=T?function(ht,K){for(var Ot=-1,wt=Array(ht);++Ot<ht;)wt[Ot]=K(Ot);return wt}(I.length,String):[],J=N.length;for(var st in I)!z&&!ut.call(I,st)||T&&(st=="length"||m&&(st=="offset"||st=="parent")||k&&(st=="buffer"||st=="byteLength"||st=="byteOffset")||Nn(st,J))||N.push(st);return N}(v):function(I){if(nt=(z=I)&&z.constructor,z!==(typeof nt=="function"&&nt.prototype||ot))return St(I);var z,nt,Y=[];for(var m in Object(I))ut.call(I,m)&&m!="constructor"&&Y.push(m);return Y}(v);var C}o.exports=function(v,C){return or(v,C)}},210:function(o,c,l){var u=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(c,"__esModule",{value:!0});var a,h=u(l(465)),d=u(l(307));(function(g){g.compose=function(y,E,D){y===void 0&&(y={}),E===void 0&&(E={}),typeof y!="object"&&(y={}),typeof E!="object"&&(E={});var S=h.default(E);for(var _ in D||(S=Object.keys(S).reduce(function(f,p){return S[p]!=null&&(f[p]=S[p]),f},{})),y)y[_]!==void 0&&E[_]===void 0&&(S[_]=y[_]);return Object.keys(S).length>0?S:void 0},g.diff=function(y,E){y===void 0&&(y={}),E===void 0&&(E={}),typeof y!="object"&&(y={}),typeof E!="object"&&(E={});var D=Object.keys(y).concat(Object.keys(E)).reduce(function(S,_){return d.default(y[_],E[_])||(S[_]=E[_]===void 0?null:E[_]),S},{});return Object.keys(D).length>0?D:void 0},g.invert=function(y,E){y===void 0&&(y={}),E===void 0&&(E={}),y=y||{};var D=Object.keys(E).reduce(function(S,_){return E[_]!==y[_]&&y[_]!==void 0&&(S[_]=E[_]),S},{});return Object.keys(y).reduce(function(S,_){return y[_]!==E[_]&&E[_]===void 0&&(S[_]=null),S},D)},g.transform=function(y,E,D){if(D===void 0&&(D=!1),typeof y!="object")return E;if(typeof E=="object"){if(!D)return E;var S=Object.keys(E).reduce(function(_,f){return y[f]===void 0&&(_[f]=E[f]),_},{});return Object.keys(S).length>0?S:void 0}}})(a||(a={})),c.default=a},895:function(o,c,l){var u=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}},a=u(l(529)),h=u(l(465)),d=u(l(307)),g=u(l(210)),y=u(l(430)),E=String.fromCharCode(0),D=function(){function S(_){Array.isArray(_)?this.ops=_:_!=null&&Array.isArray(_.ops)?this.ops=_.ops:this.ops=[]}return S.prototype.insert=function(_,f){var p={};return typeof _=="string"&&_.length===0?this:(p.insert=_,f!=null&&typeof f=="object"&&Object.keys(f).length>0&&(p.attributes=f),this.push(p))},S.prototype.delete=function(_){return _<=0?this:this.push({delete:_})},S.prototype.retain=function(_,f){if(_<=0)return this;var p={retain:_};return f!=null&&typeof f=="object"&&Object.keys(f).length>0&&(p.attributes=f),this.push(p)},S.prototype.push=function(_){var f=this.ops.length,p=this.ops[f-1];if(_=h.default(_),typeof p=="object"){if(typeof _.delete=="number"&&typeof p.delete=="number")return this.ops[f-1]={delete:p.delete+_.delete},this;if(typeof p.delete=="number"&&_.insert!=null&&(f-=1,typeof(p=this.ops[f-1])!="object"))return this.ops.unshift(_),this;if(d.default(_.attributes,p.attributes)){if(typeof _.insert=="string"&&typeof p.insert=="string")return this.ops[f-1]={insert:p.insert+_.insert},typeof _.attributes=="object"&&(this.ops[f-1].attributes=_.attributes),this;if(typeof _.retain=="number"&&typeof p.retain=="number")return this.ops[f-1]={retain:p.retain+_.retain},typeof _.attributes=="object"&&(this.ops[f-1].attributes=_.attributes),this}}return f===this.ops.length?this.ops.push(_):this.ops.splice(f,0,_),this},S.prototype.chop=function(){var _=this.ops[this.ops.length-1];return _&&_.retain&&!_.attributes&&this.ops.pop(),this},S.prototype.filter=function(_){return this.ops.filter(_)},S.prototype.forEach=function(_){this.ops.forEach(_)},S.prototype.map=function(_){return this.ops.map(_)},S.prototype.partition=function(_){var f=[],p=[];return this.forEach(function(b){(_(b)?f:p).push(b)}),[f,p]},S.prototype.reduce=function(_,f){return this.ops.reduce(_,f)},S.prototype.changeLength=function(){return this.reduce(function(_,f){return f.insert?_+y.default.length(f):f.delete?_-f.delete:_},0)},S.prototype.length=function(){return this.reduce(function(_,f){return _+y.default.length(f)},0)},S.prototype.slice=function(_,f){_===void 0&&(_=0),f===void 0&&(f=1/0);for(var p=[],b=y.default.iterator(this.ops),w=0;w<f&&b.hasNext();){var A=void 0;w<_?A=b.next(_-w):(A=b.next(f-w),p.push(A)),w+=y.default.length(A)}return new S(p)},S.prototype.compose=function(_){var f=y.default.iterator(this.ops),p=y.default.iterator(_.ops),b=[],w=p.peek();if(w!=null&&typeof w.retain=="number"&&w.attributes==null){for(var A=w.retain;f.peekType()==="insert"&&f.peekLength()<=A;)A-=f.peekLength(),b.push(f.next());w.retain-A>0&&p.next(w.retain-A)}for(var M=new S(b);f.hasNext()||p.hasNext();)if(p.peekType()==="insert")M.push(p.next());else if(f.peekType()==="delete")M.push(f.next());else{var j=Math.min(f.peekLength(),p.peekLength()),B=f.next(j),q=p.next(j);if(typeof q.retain=="number"){var G={};typeof B.retain=="number"?G.retain=j:G.insert=B.insert;var R=g.default.compose(B.attributes,q.attributes,typeof B.retain=="number");if(R&&(G.attributes=R),M.push(G),!p.hasNext()&&d.default(M.ops[M.ops.length-1],G)){var L=new S(f.rest());return M.concat(L).chop()}}else typeof q.delete=="number"&&typeof B.retain=="number"&&M.push(q)}return M.chop()},S.prototype.concat=function(_){var f=new S(this.ops.slice());return _.ops.length>0&&(f.push(_.ops[0]),f.ops=f.ops.concat(_.ops.slice(1))),f},S.prototype.diff=function(_,f){if(this.ops===_.ops)return new S;var p=[this,_].map(function(j){return j.map(function(B){if(B.insert!=null)return typeof B.insert=="string"?B.insert:E;throw new Error("diff() called "+(j===_?"on":"with")+" non-document")}).join("")}),b=new S,w=a.default(p[0],p[1],f),A=y.default.iterator(this.ops),M=y.default.iterator(_.ops);return w.forEach(function(j){for(var B=j[1].length;B>0;){var q=0;switch(j[0]){case a.default.INSERT:q=Math.min(M.peekLength(),B),b.push(M.next(q));break;case a.default.DELETE:q=Math.min(B,A.peekLength()),A.next(q),b.delete(q);break;case a.default.EQUAL:q=Math.min(A.peekLength(),M.peekLength(),B);var G=A.next(q),R=M.next(q);d.default(G.insert,R.insert)?b.retain(q,g.default.diff(G.attributes,R.attributes)):b.push(R).delete(q)}B-=q}}),b.chop()},S.prototype.eachLine=function(_,f){f===void 0&&(f=`
`);for(var p=y.default.iterator(this.ops),b=new S,w=0;p.hasNext();){if(p.peekType()!=="insert")return;var A=p.peek(),M=y.default.length(A)-p.peekLength(),j=typeof A.insert=="string"?A.insert.indexOf(f,M)-M:-1;if(j<0)b.push(p.next());else if(j>0)b.push(p.next(j));else{if(_(b,p.next(1).attributes||{},w)===!1)return;w+=1,b=new S}}b.length()>0&&_(b,{},w)},S.prototype.invert=function(_){var f=new S;return this.reduce(function(p,b){if(b.insert)f.delete(y.default.length(b));else{if(b.retain&&b.attributes==null)return f.retain(b.retain),p+b.retain;if(b.delete||b.retain&&b.attributes){var w=b.delete||b.retain;return _.slice(p,p+w).forEach(function(A){b.delete?f.push(A):b.retain&&b.attributes&&f.retain(y.default.length(A),g.default.invert(b.attributes,A.attributes))}),p+w}}return p},0),f.chop()},S.prototype.transform=function(_,f){if(f===void 0&&(f=!1),f=!!f,typeof _=="number")return this.transformPosition(_,f);for(var p=_,b=y.default.iterator(this.ops),w=y.default.iterator(p.ops),A=new S;b.hasNext()||w.hasNext();)if(b.peekType()!=="insert"||!f&&w.peekType()==="insert")if(w.peekType()==="insert")A.push(w.next());else{var M=Math.min(b.peekLength(),w.peekLength()),j=b.next(M),B=w.next(M);if(j.delete)continue;B.delete?A.push(B):A.retain(M,g.default.transform(j.attributes,B.attributes,f))}else A.retain(y.default.length(b.next()));return A.chop()},S.prototype.transformPosition=function(_,f){f===void 0&&(f=!1),f=!!f;for(var p=y.default.iterator(this.ops),b=0;p.hasNext()&&b<=_;){var w=p.peekLength(),A=p.peekType();p.next(),A!=="delete"?(A==="insert"&&(b<_||!f)&&(_+=w),b+=w):_-=Math.min(w,_-b)}return _},S.Op=y.default,S.AttributeMap=g.default,S}();o.exports=D},977:function(o,c,l){var u=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(c,"__esModule",{value:!0});var a=u(l(430)),h=function(){function d(g){this.ops=g,this.index=0,this.offset=0}return d.prototype.hasNext=function(){return this.peekLength()<1/0},d.prototype.next=function(g){g||(g=1/0);var y=this.ops[this.index];if(y){var E=this.offset,D=a.default.length(y);if(g>=D-E?(g=D-E,this.index+=1,this.offset=0):this.offset+=g,typeof y.delete=="number")return{delete:g};var S={};return y.attributes&&(S.attributes=y.attributes),typeof y.retain=="number"?S.retain=g:typeof y.insert=="string"?S.insert=y.insert.substr(E,g):S.insert=y.insert,S}return{retain:1/0}},d.prototype.peek=function(){return this.ops[this.index]},d.prototype.peekLength=function(){return this.ops[this.index]?a.default.length(this.ops[this.index])-this.offset:1/0},d.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},d.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var g=this.offset,y=this.index,E=this.next(),D=this.ops.slice(this.index);return this.offset=g,this.index=y,[E].concat(D)}return[]},d}();c.default=h},430:function(o,c,l){var u=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(c,"__esModule",{value:!0});var a,h=u(l(977));(function(d){d.iterator=function(g){return new h.default(g)},d.length=function(g){return typeof g.delete=="number"?g.delete:typeof g.retain=="number"?g.retain:typeof g.insert=="string"?g.insert.length:1}})(a||(a={})),c.default=a},165:function(o,c,l){var u,a;(a=typeof(u=function(){var h,d={};function g(D,S,_){var f=D.getClientRects();if(f.length===2){var p=D.getBoundingClientRect();return f[S][_]<p[_]}return!1}function y(D){if(!D||screen.deviceXDPI===screen.logicalXDPI)return D;if("length"in D)return Array.prototype.map.call(D,y);var S=screen.deviceXDPI/screen.logicalXDPI;return{top:D.top/S,bottom:D.bottom/S,left:D.left/S,right:D.right/S,width:D.width/S,height:D.height/S}}function E(D,S){var _,f=0,p=1024;if(p>=S.length)return Array.prototype.push.apply(D,S);for(;f<S.length;)_=Array.prototype.push.apply(D,Array.prototype.slice.call(S,f,f+p)),f+=p;return _}return d.isBroken=function(){if(h===void 0){var D=document.createElement("p"),S=document.createElement("span"),_=document.createTextNode("aa"),f=document.createTextNode("aa"),p=document.createElement("img");p.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=");var b=document.createRange();if(h={},D.appendChild(_),D.appendChild(S),S.appendChild(p),S.appendChild(f),document.body.appendChild(D),b.setStart(_,1),b.setEnd(S,0),h.getClientRects=h.getBoundingClientRect=b.getClientRects().length>1,h.getClientRects||(b.setEnd(f,1),h.getClientRects=h.getBoundingClientRect=b.getClientRects().length===2),!h.getBoundingClientRect){b.setEnd(b.startContainer,b.startOffset);var w=b.getBoundingClientRect();h.getBoundingClientRect=w.top===0&&w.left===0}if(document.body.removeChild(D),!h.getBoundingClientRect){var A=document.createElement("p");A.style.width="0px",A.style.fontSize="20px",A.style.whiteSpace="normal",A.style.wordBreak="normal";var M=document.createTextNode("m mm");A.appendChild(M),document.body.appendChild(A),b.setStart(M,1),b.setEnd(M,2),g(b,1,"left")?h.getBoundingClientRect=!0:(b.setStart(M,1),b.setEnd(M,3),g(b,0,"top")&&(h.getBoundingClientRect=!0)),document.body.removeChild(A)}var j=window.ActiveXObject&&new Function("/*@cc_on return @_jscript_version; @*/")();h.ieZoom=!!j&&j<=10}return h},d.getClientRects=function(D){var S=this.isBroken();if(S.ieZoom)return y(D.getClientRects());if(!S.getClientRects)return D.getClientRects();var _=[],f=[],p=D.endContainer,b=D.endOffset,w=document.createRange();function A(M){for(var j=0;M=M.previousSibling;)j++;return j}for(;p!==D.commonAncestorContainer;)w.setStart(p,0),w.setEnd(p,b),E(f,w.getClientRects()),b=A(p),p=p.parentNode;return(w=D.cloneRange()).setEnd(p,b),E(_,w.getClientRects()),E(_,f),_},d.getBoundingClientRect=function(D){var S=this.getClientRects(D);if(S.length===0)return null;var _,f=D.getBoundingClientRect(),p=this.isBroken();if(p.ieZoom)return y(f);if(!p.getBoundingClientRect)return f;if(f.width===0&&f.height===0)return S[0];for(var b=0,w=S.length;b<w;b++){var A=S[b];_?(_.left=Math.min(_.left,A.left),_.top=Math.min(_.top,A.top),_.right=Math.max(_.right,A.right),_.bottom=Math.max(_.bottom,A.bottom)):_={left:A.left,top:A.top,right:A.right,bottom:A.bottom}}return _&&(_.width=_.right-_.left,_.height=_.bottom-_.top),_},d})=="function"?u.call(c,l,c,o):u)===void 0||(o.exports=a)},33:(o,c,l)=>{l.r(c),l.d(c,{default:()=>R});var u=function(){if(typeof Map<"u")return Map;function L(O,x){var F=-1;return O.some(function(V,rt){return V[0]===x&&(F=rt,!0)}),F}return function(){function O(){this.__entries__=[]}return Object.defineProperty(O.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),O.prototype.get=function(x){var F=L(this.__entries__,x),V=this.__entries__[F];return V&&V[1]},O.prototype.set=function(x,F){var V=L(this.__entries__,x);~V?this.__entries__[V][1]=F:this.__entries__.push([x,F])},O.prototype.delete=function(x){var F=this.__entries__,V=L(F,x);~V&&F.splice(V,1)},O.prototype.has=function(x){return!!~L(this.__entries__,x)},O.prototype.clear=function(){this.__entries__.splice(0)},O.prototype.forEach=function(x,F){F===void 0&&(F=null);for(var V=0,rt=this.__entries__;V<rt.length;V++){var dt=rt[V];x.call(F,dt[1],dt[0])}},O}()}(),a=typeof window<"u"&&typeof document<"u"&&window.document===document,h=l.g!==void 0&&l.g.Math===Math?l.g:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")(),d=typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(h):function(L){return setTimeout(function(){return L(Date.now())},1e3/60)},g=["top","right","bottom","left","width","height","size","weight"],y=typeof MutationObserver<"u",E=function(){function L(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(O,x){var F=!1,V=!1,rt=0;function dt(){F&&(F=!1,O()),V&&pt()}function vt(){d(dt)}function pt(){var P=Date.now();if(F){if(P-rt<2)return;V=!0}else F=!0,V=!1,setTimeout(vt,20);rt=P}return pt}(this.refresh.bind(this))}return L.prototype.addObserver=function(O){~this.observers_.indexOf(O)||this.observers_.push(O),this.connected_||this.connect_()},L.prototype.removeObserver=function(O){var x=this.observers_,F=x.indexOf(O);~F&&x.splice(F,1),!x.length&&this.connected_&&this.disconnect_()},L.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},L.prototype.updateObservers_=function(){var O=this.observers_.filter(function(x){return x.gatherActive(),x.hasActive()});return O.forEach(function(x){return x.broadcastActive()}),O.length>0},L.prototype.connect_=function(){a&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),y?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},L.prototype.disconnect_=function(){a&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},L.prototype.onTransitionEnd_=function(O){var x=O.propertyName,F=x===void 0?"":x;g.some(function(V){return!!~F.indexOf(V)})&&this.refresh()},L.getInstance=function(){return this.instance_||(this.instance_=new L),this.instance_},L.instance_=null,L}(),D=function(L,O){for(var x=0,F=Object.keys(O);x<F.length;x++){var V=F[x];Object.defineProperty(L,V,{value:O[V],enumerable:!1,writable:!1,configurable:!0})}return L},S=function(L){return L&&L.ownerDocument&&L.ownerDocument.defaultView||h},_=A(0,0,0,0);function f(L){return parseFloat(L)||0}function p(L){for(var O=[],x=1;x<arguments.length;x++)O[x-1]=arguments[x];return O.reduce(function(F,V){return F+f(L["border-"+V+"-width"])},0)}var b=typeof SVGGraphicsElement<"u"?function(L){return L instanceof S(L).SVGGraphicsElement}:function(L){return L instanceof S(L).SVGElement&&typeof L.getBBox=="function"};function w(L){return a?b(L)?function(O){var x=O.getBBox();return A(0,0,x.width,x.height)}(L):function(O){var x=O.clientWidth,F=O.clientHeight;if(!x&&!F)return _;var V=S(O).getComputedStyle(O),rt=function(Z){for(var at={},tt=0,yt=["top","right","bottom","left"];tt<yt.length;tt++){var It=yt[tt],ot=Z["padding-"+It];at[It]=f(ot)}return at}(V),dt=rt.left+rt.right,vt=rt.top+rt.bottom,pt=f(V.width),P=f(V.height);if(V.boxSizing==="border-box"&&(Math.round(pt+dt)!==x&&(pt-=p(V,"left","right")+dt),Math.round(P+vt)!==F&&(P-=p(V,"top","bottom")+vt)),!function(Z){return Z===S(Z).document.documentElement}(O)){var se=Math.round(pt+dt)-x,Vt=Math.round(P+vt)-F;Math.abs(se)!==1&&(pt-=se),Math.abs(Vt)!==1&&(P-=Vt)}return A(rt.left,rt.top,pt,P)}(L):_}function A(L,O,x,F){return{x:L,y:O,width:x,height:F}}var M=function(){function L(O){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=A(0,0,0,0),this.target=O}return L.prototype.isActive=function(){var O=w(this.target);return this.contentRect_=O,O.width!==this.broadcastWidth||O.height!==this.broadcastHeight},L.prototype.broadcastRect=function(){var O=this.contentRect_;return this.broadcastWidth=O.width,this.broadcastHeight=O.height,O},L}(),j=function(L,O){var x,F,V,rt,dt,vt,pt,P=(F=(x=O).x,V=x.y,rt=x.width,dt=x.height,vt=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,pt=Object.create(vt.prototype),D(pt,{x:F,y:V,width:rt,height:dt,top:V,right:F+rt,bottom:dt+V,left:F}),pt);D(this,{target:L,contentRect:P})},B=function(){function L(O,x,F){if(this.activeObservations_=[],this.observations_=new u,typeof O!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=O,this.controller_=x,this.callbackCtx_=F}return L.prototype.observe=function(O){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(O instanceof S(O).Element))throw new TypeError('parameter 1 is not of type "Element".');var x=this.observations_;x.has(O)||(x.set(O,new M(O)),this.controller_.addObserver(this),this.controller_.refresh())}},L.prototype.unobserve=function(O){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(O instanceof S(O).Element))throw new TypeError('parameter 1 is not of type "Element".');var x=this.observations_;x.has(O)&&(x.delete(O),x.size||this.controller_.removeObserver(this))}},L.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},L.prototype.gatherActive=function(){var O=this;this.clearActive(),this.observations_.forEach(function(x){x.isActive()&&O.activeObservations_.push(x)})},L.prototype.broadcastActive=function(){if(this.hasActive()){var O=this.callbackCtx_,x=this.activeObservations_.map(function(F){return new j(F.target,F.broadcastRect())});this.callback_.call(O,x,O),this.clearActive()}},L.prototype.clearActive=function(){this.activeObservations_.splice(0)},L.prototype.hasActive=function(){return this.activeObservations_.length>0},L}(),q=typeof WeakMap<"u"?new WeakMap:new u,G=function L(O){if(!(this instanceof L))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var x=E.getInstance(),F=new B(O,x,this);q.set(this,F)};["observe","unobserve","disconnect"].forEach(function(L){G.prototype[L]=function(){var O;return(O=q.get(this))[L].apply(O,arguments)}});const R=h.ResizeObserver!==void 0?h.ResizeObserver:G},413:(o,c,l)=>{l.r(c),l.d(c,{default:()=>A});var u=l(379),a=l.n(u),h=l(795),d=l.n(h),g=l(569),y=l.n(g),E=l(565),D=l.n(E),S=l(216),_=l.n(S),f=l(589),p=l.n(f),b=l(582),w={};w.styleTagTransform=p(),w.setAttributes=D(),w.insert=y().bind(null,"head"),w.domAPI=d(),w.insertStyleElement=_(),a()(b.Z,w);const A=b.Z&&b.Z.locals?b.Z.locals:void 0},379:o=>{var c=[];function l(h){for(var d=-1,g=0;g<c.length;g++)if(c[g].identifier===h){d=g;break}return d}function u(h,d){for(var g={},y=[],E=0;E<h.length;E++){var D=h[E],S=d.base?D[0]+d.base:D[0],_=g[S]||0,f="".concat(S," ").concat(_);g[S]=_+1;var p=l(f),b={css:D[1],media:D[2],sourceMap:D[3],supports:D[4],layer:D[5]};if(p!==-1)c[p].references++,c[p].updater(b);else{var w=a(b,d);d.byIndex=E,c.splice(E,0,{identifier:f,updater:w,references:1})}y.push(f)}return y}function a(h,d){var g=d.domAPI(d);return g.update(h),function(y){if(y){if(y.css===h.css&&y.media===h.media&&y.sourceMap===h.sourceMap&&y.supports===h.supports&&y.layer===h.layer)return;g.update(h=y)}else g.remove()}}o.exports=function(h,d){var g=u(h=h||[],d=d||{});return function(y){y=y||[];for(var E=0;E<g.length;E++){var D=l(g[E]);c[D].references--}for(var S=u(y,d),_=0;_<g.length;_++){var f=l(g[_]);c[f].references===0&&(c[f].updater(),c.splice(f,1))}g=S}}},569:o=>{var c={};o.exports=function(l,u){var a=function(h){if(c[h]===void 0){var d=document.querySelector(h);if(window.HTMLIFrameElement&&d instanceof window.HTMLIFrameElement)try{d=d.contentDocument.head}catch{d=null}c[h]=d}return c[h]}(l);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(u)}},216:o=>{o.exports=function(c){var l=document.createElement("style");return c.setAttributes(l,c.attributes),c.insert(l,c.options),l}},565:(o,c,l)=>{o.exports=function(u){var a=l.nc;a&&u.setAttribute("nonce",a)}},795:o=>{o.exports=function(c){var l=c.insertStyleElement(c);return{update:function(u){(function(a,h,d){var g="";d.supports&&(g+="@supports (".concat(d.supports,") {")),d.media&&(g+="@media ".concat(d.media," {"));var y=d.layer!==void 0;y&&(g+="@layer".concat(d.layer.length>0?" ".concat(d.layer):""," {")),g+=d.css,y&&(g+="}"),d.media&&(g+="}"),d.supports&&(g+="}");var E=d.sourceMap;E&&typeof btoa<"u"&&(g+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(E))))," */")),h.styleTagTransform(g,a,h.options)})(l,c,u)},remove:function(){(function(u){if(u.parentNode===null)return!1;u.parentNode.removeChild(u)})(l)}}}},589:o=>{o.exports=function(c,l){if(l.styleSheet)l.styleSheet.cssText=c;else{for(;l.firstChild;)l.removeChild(l.firstChild);l.appendChild(document.createTextNode(c))}}},607:function(o,c,l){var u=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(c,"__esModule",{value:!0}),c.Cursor=c.default=void 0;var a=u(l(678));c.default=a.default;var h=u(l(353));c.Cursor=h.default,l(413)},353:(o,c)=>{Object.defineProperty(c,"__esModule",{value:!0});var l=function(){function u(a,h,d){this.id=a,this.name=h,this.color=d,this.toggleNearCursor=this.toggleNearCursor.bind(this),this._toggleOpenedCursor=this._toggleOpenedCursor.bind(this),this._setHoverState=this._setHoverState.bind(this)}return u.prototype.build=function(a){var h=document.createElement(u.CONTAINER_ELEMENT_TAG);h.classList.add(u.CURSOR_CLASS),h.id="ql-cursor-".concat(this.id),h.innerHTML=a.template;var d=h.getElementsByClassName(u.SELECTION_CLASS)[0],g=h.getElementsByClassName(u.CARET_CONTAINER_CLASS)[0],y=g.getElementsByClassName(u.CARET_CLASS)[0],E=h.getElementsByClassName(u.FLAG_CLASS)[0];return E.style.backgroundColor=this.color,y.style.backgroundColor=this.color,h.getElementsByClassName(u.NAME_CLASS)[0].textContent=this.name,this._hideDelay="".concat(a.hideDelayMs,"ms"),this._hideSpeedMs=a.hideSpeedMs,this._positionFlag=a.positionFlag,E.style.transitionDelay=this._hideDelay,E.style.transitionDuration="".concat(this._hideSpeedMs,"ms"),this._el=h,this._selectionEl=d,this._caretEl=g,this._flagEl=E,g.addEventListener("mouseover",this._setHoverState,{passive:!0}),this._el},u.prototype.show=function(){this._el.classList.remove(u.HIDDEN_CLASS)},u.prototype.hide=function(){this._el.classList.add(u.HIDDEN_CLASS)},u.prototype.remove=function(){this._el.parentNode.removeChild(this._el)},u.prototype.toggleNearCursor=function(a,h){var d=this._getCoordinates(),g=d.left,y=d.right,E=d.top,D=d.bottom,S=a>=g&&a<=y&&h>=E&&h<=D;return this._caretEl.classList.toggle(u.CONTAINER_HOVER_CLASS,S),S},u.prototype.toggleFlag=function(a){var h=this;this._caretEl.classList.toggle(u.CONTAINER_HOVER_CLASS,a)||(this._flagEl.classList.add(u.NO_DELAY_CLASS),setTimeout(function(){return h._flagEl.classList.remove(u.NO_DELAY_CLASS)},this._hideSpeedMs))},u.prototype.updateCaret=function(a,h){this._caretEl.style.top="".concat(a.top,"px"),this._caretEl.style.left="".concat(a.left,"px"),this._caretEl.style.height="".concat(a.height,"px"),this._positionFlag?this._positionFlag(this._flagEl,a,h):this._updateCaretFlag(a,h)},u.prototype.updateSelection=function(a,h){var d=this;this._clearSelection(),a=a||[],a=Array.from(a),a=this._sanitize(a),(a=this._sortByDomPosition(a)).forEach(function(g){return d._addSelection(g,h)})},u.prototype._setHoverState=function(){document.addEventListener("mousemove",this._toggleOpenedCursor,{passive:!0})},u.prototype._toggleOpenedCursor=function(a){var h=this.toggleNearCursor(a.clientX,a.clientY);this._caretEl.classList.toggle(u.CONTAINER_NO_POINTER_CLASS,h),h||document.removeEventListener("mousemove",this._toggleOpenedCursor)},u.prototype._getCoordinates=function(){return this._caretEl.getBoundingClientRect()},u.prototype._updateCaretFlag=function(a,h){this._flagEl.style.width="";var d=this._flagEl.getBoundingClientRect();this._flagEl.classList.remove(u.FLAG_FLIPPED_CLASS),a.left>h.width-d.width&&this._flagEl.classList.add(u.FLAG_FLIPPED_CLASS),this._flagEl.style.left="".concat(a.left,"px"),this._flagEl.style.top="".concat(a.top,"px"),this._flagEl.style.width="".concat(Math.ceil(d.width),"px")},u.prototype._clearSelection=function(){this._selectionEl.innerHTML=""},u.prototype._addSelection=function(a,h){var d=this._selectionBlock(a,h);this._selectionEl.appendChild(d)},u.prototype._selectionBlock=function(a,h){var d=document.createElement(u.SELECTION_ELEMENT_TAG);return d.classList.add(u.SELECTION_BLOCK_CLASS),d.style.top="".concat(a.top-h.top,"px"),d.style.left="".concat(a.left-h.left,"px"),d.style.width="".concat(a.width,"px"),d.style.height="".concat(a.height,"px"),d.style.backgroundColor=this.color,d.style.opacity="0.3",d},u.prototype._sortByDomPosition=function(a){return a.sort(function(h,d){return h.top===d.top?h.left-d.left:h.top-d.top})},u.prototype._sanitize=function(a){var h=this,d=new Set;return a.filter(function(g){if(!g.width||!g.height)return!1;var y=h._serialize(g);return!d.has(y)&&(d.add(y),!0)})},u.prototype._serialize=function(a){return["top:".concat(a.top),"right:".concat(a.right),"bottom:".concat(a.bottom),"left:".concat(a.left)].join(";")},u.CONTAINER_ELEMENT_TAG="SPAN",u.SELECTION_ELEMENT_TAG="SPAN",u.CURSOR_CLASS="ql-cursor",u.SELECTION_CLASS="ql-cursor-selections",u.SELECTION_BLOCK_CLASS="ql-cursor-selection-block",u.CARET_CLASS="ql-cursor-caret",u.CARET_CONTAINER_CLASS="ql-cursor-caret-container",u.CONTAINER_HOVER_CLASS="hover",u.CONTAINER_NO_POINTER_CLASS="no-pointer",u.FLAG_CLASS="ql-cursor-flag",u.FLAG_FLIPPED_CLASS="flag-flipped",u.NAME_CLASS="ql-cursor-name",u.HIDDEN_CLASS="hidden",u.NO_DELAY_CLASS="no-delay",u}();c.default=l},678:function(o,c,l){var u=this&&this.__createBinding||(Object.create?function(f,p,b,w){w===void 0&&(w=b);var A=Object.getOwnPropertyDescriptor(p,b);A&&!("get"in A?!p.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return p[b]}}),Object.defineProperty(f,w,A)}:function(f,p,b,w){w===void 0&&(w=b),f[w]=p[b]}),a=this&&this.__setModuleDefault||(Object.create?function(f,p){Object.defineProperty(f,"default",{enumerable:!0,value:p})}:function(f,p){f.default=p}),h=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var p={};if(f!=null)for(var b in f)b!=="default"&&Object.prototype.hasOwnProperty.call(f,b)&&u(p,f,b);return a(p,f),p},d=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(c,"__esModule",{value:!0});var g=d(l(353)),y=h(l(165)),E=d(l(338)),D=d(l(33)),S=l(895),_=function(){function f(p,b){b===void 0&&(b={}),this._cursors={},this._isObserving=!1,this._handleCursorTouch=this._handleCursorTouch.bind(this),this.quill=p,this.options=this._setDefaults(b),this._container=this.quill.addContainer(this.options.containerClass),this._boundsContainer=this.options.boundsContainer||this.quill.container,this._currentSelection=this.quill.getSelection(),this._registerSelectionChangeListeners(),this._registerTextChangeListener(),this._registerDomListeners()}return f.prototype.createCursor=function(p,b,w){var A=this._cursors[p];if(!A){A=new g.default(p,b,w),this._cursors[p]=A;var M=A.build(this.options);this._container.appendChild(M)}return A},f.prototype.moveCursor=function(p,b){var w=this._cursors[p];w&&(w.range=b,this._updateCursor(w))},f.prototype.removeCursor=function(p){var b=this._cursors[p];b&&(b.remove(),delete this._cursors[p])},f.prototype.update=function(){var p=this;this.cursors().forEach(function(b){return p._updateCursor(b)})},f.prototype.clearCursors=function(){var p=this;this.cursors().forEach(function(b){return p.removeCursor(b.id)})},f.prototype.toggleFlag=function(p,b){var w=this._cursors[p];w&&w.toggleFlag(b)},f.prototype.cursors=function(){var p=this;return Object.keys(this._cursors).map(function(b){return p._cursors[b]})},f.prototype._registerSelectionChangeListeners=function(){var p=this;this.quill.on(this.quill.constructor.events.SELECTION_CHANGE,function(b){p._currentSelection=b})},f.prototype._registerTextChangeListener=function(){var p=this;this.quill.on(this.quill.constructor.events.TEXT_CHANGE,function(b){return p._handleTextChange(b)})},f.prototype._registerDomListeners=function(){var p=this,b=this.quill.container.getElementsByClassName("ql-editor")[0];b.addEventListener("scroll",function(){return p.update()},{passive:!0}),b.addEventListener("touchstart",this._handleCursorTouch,{passive:!0})},f.prototype._handleCursorTouch=function(p){var b=this;this.cursors().forEach(function(w){w.toggleNearCursor(p.pageX,p.pageY),setTimeout(function(){return w.toggleFlag(!1)},b.options.hideDelayMs)})},f.prototype._registerResizeObserver=function(){var p=this;if(!this._isObserving){var b=this.quill.container.getElementsByClassName("ql-editor")[0],w=new D.default(function(A){if(!A[0].target.isConnected)return w.disconnect(),void(p._isObserving=!1);p.update()});w.observe(b),this._isObserving=!0}},f.prototype._updateCursor=function(p){if(this._registerResizeObserver(),!p.range)return p.hide();var b=this._indexWithinQuillBounds(p.range.index),w=this._indexWithinQuillBounds(p.range.index+p.range.length),A=this.quill.getLeaf(b),M=this.quill.getLeaf(w);if(!this._leafIsValid(A)||!this._leafIsValid(M))return p.hide();p.show();var j=this._boundsContainer.getBoundingClientRect(),B=this.quill.getBounds(w);p.updateCaret(B,j);var q=this._lineRanges(p,A,M).reduce(function(G,R){return G.concat(Array.from(y.getClientRects(R)))},[]);p.updateSelection(q,j)},f.prototype._indexWithinQuillBounds=function(p){var b=this.quill.getLength(),w=b?b-1:0;return p=Math.max(p,0),Math.min(p,w)},f.prototype._leafIsValid=function(p){return p&&p[0]&&p[0].domNode&&p[1]>=0},f.prototype._handleTextChange=function(p){var b=this;window.setTimeout(function(){b.options.transformOnTextChange&&b._transformCursors(p),b.options.selectionChangeSource&&(b._emitSelection(),b.update())})},f.prototype._emitSelection=function(){this.quill.emitter.emit(this.quill.constructor.events.SELECTION_CHANGE,this.quill.getSelection(),this._currentSelection,this.options.selectionChangeSource)},f.prototype._setDefaults=function(p){return(p=Object.assign({},p)).template||(p.template=f.DEFAULTS.template),p.containerClass||(p.containerClass=f.DEFAULTS.containerClass),p.selectionChangeSource!==null&&(p.selectionChangeSource||(p.selectionChangeSource=f.DEFAULTS.selectionChangeSource)),p.hideDelayMs=Number.isInteger(p.hideDelayMs)?p.hideDelayMs:f.DEFAULTS.hideDelayMs,p.hideSpeedMs=Number.isInteger(p.hideSpeedMs)?p.hideSpeedMs:f.DEFAULTS.hideSpeedMs,p.transformOnTextChange=!!p.transformOnTextChange,p},f.prototype._lineRanges=function(p,b,w){var A=this.quill.getLines(p.range);return A.reduce(function(M,j,B){if(!j.children){var q=document.createRange();return q.selectNode(j.domNode),M.concat(q)}var G=B===0?b:j.path(0).pop(),R=G[0],L=G[1],O=B===A.length-1?w:j.path(j.length()-1).pop(),x=O[0],F=O[1],V=document.createRange();return R.domNode.nodeType===Node.TEXT_NODE?V.setStart(R.domNode,L):V.setStartBefore(R.domNode),x.domNode.nodeType===Node.TEXT_NODE?V.setEnd(x.domNode,F):V.setEndAfter(x.domNode),M.concat(V)},[])},f.prototype._transformCursors=function(p){var b=this;p=new S(p),this.cursors().filter(function(w){return w.range}).forEach(function(w){w.range.index=p.transformPosition(w.range.index),b._updateCursor(w)})},f.DEFAULTS={template:E.default,containerClass:"ql-cursors",selectionChangeSource:"api",hideDelayMs:3e3,hideSpeedMs:400},f}();c.default=_},338:function(o,c,l){var u=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(c,"__esModule",{value:!0});var a=u(l(353)),h=`
  <span class="`.concat(a.default.SELECTION_CLASS,`"></span>
  <span class="`).concat(a.default.CARET_CONTAINER_CLASS,`">
    <span class="`).concat(a.default.CARET_CLASS,`"></span>
  </span>
  <div class="`).concat(a.default.FLAG_CLASS,`">
    <small class="`).concat(a.default.NAME_CLASS,`"></small>
  </div>
`);c.default=h}},r={};function s(o){var c=r[o];if(c!==void 0)return c.exports;var l=r[o]={id:o,loaded:!1,exports:{}};return n[o].call(l.exports,l,l.exports,s),l.loaded=!0,l.exports}s.n=o=>{var c=o&&o.__esModule?()=>o.default:()=>o;return s.d(c,{a:c}),c},s.d=(o,c)=>{for(var l in c)s.o(c,l)&&!s.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:c[l]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.nmd=o=>(o.paths=[],o.children||(o.children=[]),o),s.nc=void 0;var i=s(607);return i.default})())})(Ho);var Ga=Ho.exports;const Wa=$a(Ga),$o=new Map;class Ja{constructor(t){this.room=t,this.onmessage=null,this._onChange=n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:nl(n.newValue||"")}),Nc(this._onChange)}postMessage(t){fi.setItem(this.room,el(Xc(t)))}close(){Uc(this._onChange)}}const Ya=typeof BroadcastChannel>"u"?Ja:BroadcastChannel,Vs=e=>Jt($o,e,()=>{const t=Pe(),n=new Ya(e);return n.onmessage=r=>t.forEach(s=>s(r.data,"broadcastchannel")),{bc:n,subs:t}}),Xa=(e,t)=>(Vs(e).subs.add(t),t),Ka=(e,t)=>{const n=Vs(e),r=n.subs.delete(t);return r&&n.subs.size===0&&(n.bc.close(),$o.delete(e)),r},Tn=(e,t,n=null)=>{const r=Vs(e);r.bc.postMessage(t),r.subs.forEach(s=>s(t,n))},Go=0,zs=1,Wo=2,qs=(e,t)=>{U(e,Go);const n=Ui(t);Ct(e,n)},Jo=(e,t,n)=>{U(e,zs),Ct(e,ji(t,n))},Qa=(e,t,n)=>Jo(t,n,Ht(e)),Yo=(e,t,n)=>{try{Mi(t,Ht(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Za=(e,t)=>{U(e,Wo),Ct(e,t)},tu=Yo,eu=(e,t,n,r)=>{const s=$(e);switch(s){case Go:Qa(e,t,n);break;case zs:Yo(e,n,r);break;case Wo:tu(e,n,r);break;default:throw new Error("Unknown message type")}return s},nu=0,ru=(e,t,n)=>{switch($(e)){case nu:n(t,Me(e))}},su=e=>Vc(e,(t,n)=>`${encodeURIComponent(n)}=${encodeURIComponent(t)}`).join("&"),vn=0,Xo=3,Mn=1,iu=2,rr=[];rr[vn]=(e,t,n,r,s)=>{U(e,vn);const i=eu(t,e,n.doc,n);r&&i===zs&&!n.synced&&(n.synced=!0)},rr[Xo]=(e,t,n,r,s)=>{U(e,Mn),Ct(e,nr(n.awareness,Array.from(n.awareness.getStates().keys())))},rr[Mn]=(e,t,n,r,s)=>{Pa(n.awareness,Ht(t),n)},rr[iu]=(e,t,n,r,s)=>{ru(t,n.doc,(i,o)=>ou(n,o))};const Ko=3e4,ou=(e,t)=>console.warn(`Permission denied to access ${e.url}.
${t}`),Qo=(e,t,n)=>{const r=Nt(t),s=Rt(),i=$(r),o=e.messageHandlers[i];return o?o(s,r,e,n,i):console.error("Unable to compute message"),s},Ps=(e,t,n)=>{t===e.ws&&(e.emit("connection-close",[n,e]),e.ws=null,t.close(),e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,Fs(e.awareness,Array.from(e.awareness.getStates().keys()).filter(r=>r!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(Zo,Jr(lc(2,e.wsUnsuccessfulReconnects)*100,e.maxBackoffTime),e))},Zo=e=>{if(e.shouldConnect&&e.ws===null){const t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=n=>{e.wsLastMessageReceived=Ge();const r=Qo(e,new Uint8Array(n.data),!0);Qr(r)>1&&t.send(ft(r))},t.onerror=n=>{e.emit("connection-error",[n,e])},t.onclose=n=>{Ps(e,t,n)},t.onopen=()=>{e.wsLastMessageReceived=Ge(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const n=Rt();if(U(n,vn),qs(n,e.doc),t.send(ft(n)),e.awareness.getLocalState()!==null){const r=Rt();U(r,Mn),Ct(r,nr(e.awareness,[e.doc.clientID])),t.send(ft(r))}},e.emit("status",[{status:"connecting"}])}},Hs=(e,t)=>{const n=e.ws;e.wsconnected&&n&&n.readyState===n.OPEN&&n.send(t),e.bcconnected&&Tn(e.bcChannel,t,e)};class cu extends ur{constructor(t,n,r,{connect:s=!0,awareness:i=new qa(r),params:o={},protocols:c=[],WebSocketPolyfill:l=WebSocket,resyncInterval:u=-1,maxBackoffTime:a=2500,disableBc:h=!1}={}){for(super();t[t.length-1]==="/";)t=t.slice(0,t.length-1);this.serverUrl=t,this.bcChannel=t+"/"+n,this.maxBackoffTime=a,this.params=o,this.protocols=c,this.roomname=n,this.doc=r,this._WS=l,this.awareness=i,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=h,this.wsUnsuccessfulReconnects=0,this.messageHandlers=rr.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,u>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const d=Rt();U(d,vn),qs(d,r),this.ws.send(ft(d))}},u)),this._bcSubscriber=(d,g)=>{if(g!==this){const y=Qo(this,new Uint8Array(d),!1);Qr(y)>1&&Tn(this.bcChannel,ft(y),this)}},this._updateHandler=(d,g)=>{if(g!==this){const y=Rt();U(y,vn),Za(y,d),Hs(this,ft(y))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:g,removed:y},E)=>{const D=d.concat(g).concat(y),S=Rt();U(S,Mn),Ct(S,nr(i,D)),Hs(this,ft(S))},this._exitHandler=()=>{Fs(this.awareness,[r.clientID],"app closed")},We&&typeof process<"u"&&process.on("exit",this._exitHandler),i.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&Ko<Ge()-this.wsLastMessageReceived&&Ps(this,this.ws,null)},Ko/10),s&&this.connect()}get url(){const t=su(this.params);return this.serverUrl+"/"+this.roomname+(t.length===0?"":"?"+t)}get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),We&&typeof process<"u"&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(Xa(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const t=Rt();U(t,vn),qs(t,this.doc),Tn(this.bcChannel,ft(t),this);const n=Rt();U(n,vn),Jo(n,this.doc),Tn(this.bcChannel,ft(n),this);const r=Rt();U(r,Xo),Tn(this.bcChannel,ft(r),this);const s=Rt();U(s,Mn),Ct(s,nr(this.awareness,[this.doc.clientID])),Tn(this.bcChannel,ft(s),this)}disconnectBc(){const t=Rt();U(t,Mn),Ct(t,nr(this.awareness,[this.doc.clientID],new Map)),Hs(this,ft(t)),this.bcconnected&&(Ka(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&Ps(this,this.ws,null)}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Zo(this),this.connectBc())}}Le.QuillBinding=Ha,Le.QuillCursors=Wa,Le.WebsocketProvider=cu,Le.Y=za,Object.defineProperty(Le,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=editor-bundle.umd.js.map
